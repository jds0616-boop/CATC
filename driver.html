<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>SHUTTLE DASHBOARD</title>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">

  <style>
    :root{
      --bg: #f6f7fb;
      --ink: #0f172a;
      --muted:#64748b;
      --card:#ffffff;
      --line:#e6e8ef;
      --shadow: 0 10px 30px rgba(15,23,42,.08);

      --osong:#2563eb;      /* blue */
      --terminal:#f59e0b;   /* amber */
      --airport:#10b981;    /* emerald */
    }

    *{box-sizing:border-box}
    body{
      font-family:'Pretendard',system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans KR',sans-serif;
      background: var(--bg);
      margin:0; color:var(--ink);
      line-height:1.55;
    }

    .dashboard-wrapper{
      max-width: 1100px;
      margin: 0 auto;
      padding: 18px 14px 88px;
    }

    /* Header */
    .app-header{
      position: sticky;
      top: 0;
      z-index: 10;
      background: rgba(255,255,255,.75);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(230,232,239,.6);
      border-radius: 18px;
      padding: 16px 16px 14px;
      box-shadow: var(--shadow);
      margin-bottom: 14px;
    }
    .app-header h1{
      margin:0;
      font-size: 18px;
      font-weight: 900;
      letter-spacing: -0.3px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .app-header h1 .dot{
      width:10px;height:10px;border-radius:999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34,197,94,.12);
      flex:0 0 auto;
    }
    .app-header p{
      margin:6px 0 0;
      color: var(--muted);
      font-size: 12px;
      font-weight: 600;
    }

    /* Summary */
    .stats-grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 14px;
    }
    .stat-card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 14px 14px;
      box-shadow: var(--shadow);
      display:flex;
      align-items:center;
      justify-content:space-between;
      min-height: 62px;
    }
    .stat-left{
      display:flex;align-items:center;gap:10px;
    }
    .pill{
      width: 10px;height: 34px;border-radius: 999px;
      opacity:.95;
    }
    .stat-meta{
      display:flex;flex-direction:column;
      gap:2px;
    }
    .stat-meta span{
      font-size: 12px;
      color: var(--muted);
      font-weight: 700;
    }
    .stat-meta strong{
      font-size: 20px;
      font-weight: 900;
      letter-spacing: -0.4px;
    }

    /* Main grid */
    .main-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 14px;
    }

    .destination-block{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 18px;
      overflow:hidden;
      box-shadow: var(--shadow);
    }

    .dest-header{
      padding: 14px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom: 1px solid rgba(255,255,255,.12);
      color:#fff;
    }
    .dest-header h2{
      margin:0;
      font-size: 15px;
      font-weight: 900;
      letter-spacing: -0.2px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .dest-header h2 i{opacity:.95}
    .total-badge{
      background: rgba(255,255,255,.18);
      border: 1px solid rgba(255,255,255,.22);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 900;
    }
    .osong-bg{background: linear-gradient(135deg, rgba(37,99,235,1), rgba(59,130,246,1));}
    .terminal-bg{background: linear-gradient(135deg, rgba(245,158,11,1), rgba(251,191,36,1));}
    .airport-bg{background: linear-gradient(135deg, rgba(16,185,129,1), rgba(52,211,153,1));}

    .dest-content{
      padding: 12px 12px 14px;
    }

    /* Room list (clean) */
    .room-unit{
      background: #fbfcff;
      border: 1px solid var(--line);
      border-radius: 14px;
      overflow:hidden;
      margin-bottom: 10px;
    }
    .room-unit-header{
      padding: 10px 12px;
      background: #0b1220;
      color:#fff;
      display:flex;
      align-items:center;
      justify-content:space-between;
      font-size: 12px;
      font-weight: 900;
      letter-spacing: .2px;
    }
    .room-unit-header span:last-child{
      color: rgba(255,255,255,.92);
      font-weight: 900;
    }

    /* Names: less "sticker", more "list" */
    .names-flex{
      padding: 10px 12px 12px;
      display:flex;
      flex-wrap:wrap;
      gap: 6px 10px;
    }
    .name-label{
      background: transparent;
      border: none;
      box-shadow:none;
      padding: 0;
      border-radius: 0;
      font-size: 14px;
      font-weight: 800;
      color: #111827;
    }
    .name-label::before{
      content:"•";
      margin-right: 6px;
      color: #94a3b8;
      font-weight: 900;
    }

    .empty-info{
      text-align:center;
      padding: 32px 12px;
      color: #94a3b8;
      font-weight: 700;
      border: 1px dashed rgba(148,163,184,.5);
      border-radius: 14px;
      background: #fafafa;
    }

    /* bottom bar: smaller + subtle */
    .bottom-sync{
      position: fixed;
      bottom: 14px;
      left: 50%;
      transform: translateX(-50%);
      width: min(520px, calc(100% - 24px));
      background: rgba(15, 23, 42, .92);
      color: #a7f3d0;
      padding: 10px 12px;
      text-align: center;
      font-size: 12px;
      font-weight: 800;
      border-radius: 999px;
      box-shadow: 0 16px 40px rgba(15,23,42,.22);
      backdrop-filter: blur(8px);
      z-index: 1000;
    }
    .bottom-sync i{margin-right:6px}

    /* Mobile */
    @media (max-width: 640px){
      .stats-grid{grid-template-columns: 1fr;}
      .app-header{border-radius: 16px;}
      .destination-block{border-radius: 16px;}
    }
  </style>
</head>

<body>
  <div class="dashboard-wrapper">

    <header class="app-header">
      <h1><span class="dot"></span> 셔틀 탑승객 통합 현황</h1>
      <p id="updateTimeText">데이터를 실시간으로 불러오는 중...</p>
    </header>

    <!-- 상단 요약 바 -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-left">
          <div class="pill" style="background: var(--osong)"></div>
          <div class="stat-meta">
            <span>오송역</span>
            <strong id="total-osong">0</strong>
          </div>
        </div>
        <i class="fa-solid fa-train" style="opacity:.35"></i>
      </div>

      <div class="stat-card">
        <div class="stat-left">
          <div class="pill" style="background: var(--terminal)"></div>
          <div class="stat-meta">
            <span>터미널</span>
            <strong id="total-terminal">0</strong>
          </div>
        </div>
        <i class="fa-solid fa-bus-simple" style="opacity:.35"></i>
      </div>

      <div class="stat-card">
        <div class="stat-left">
          <div class="pill" style="background: var(--airport)"></div>
          <div class="stat-meta">
            <span>청주공항</span>
            <strong id="total-airport">0</strong>
          </div>
        </div>
        <i class="fa-solid fa-plane-up" style="opacity:.35"></i>
      </div>
    </div>

    <!-- 메인 콘텐츠 그리드 -->
    <div class="main-grid">

      <!-- 오송역 블록 -->
      <div class="destination-block">
        <div class="dest-header osong-bg">
          <h2><i class="fa-solid fa-train"></i> 오송역</h2>
          <span class="total-badge" id="badge-osong">0명</span>
        </div>
        <div id="list-osong" class="dest-content"></div>
      </div>

      <!-- 터미널 블록 -->
      <div class="destination-block">
        <div class="dest-header terminal-bg">
          <h2><i class="fa-solid fa-bus-simple"></i> 청주터미널</h2>
          <span class="total-badge" id="badge-terminal">0명</span>
        </div>
        <div id="list-terminal" class="dest-content"></div>
      </div>

      <!-- 공항 블록 -->
      <div class="destination-block">
        <div class="dest-header airport-bg">
          <h2><i class="fa-solid fa-plane-up"></i> 청주공항</h2>
          <span class="total-badge" id="badge-airport">0명</span>
        </div>
        <div id="list-airport" class="dest-content"></div>
      </div>

    </div>
  </div>

  <div class="bottom-sync">
    <i class="fa-solid fa-circle-dot"></i> LIVE DATA SYNC ACTIVE
  </div>

  <script src="config.js"></script>
  <script>
    firebase.database().ref('courses').on('value', snap => {
      const allRooms = snap.val() || {};
      const totals = { osong: 0, terminal: 0, airport: 0 };
      const details = { osong: {}, terminal: {}, airport: {} };

      Object.keys(allRooms).forEach(roomId => {
        const shuttle = allRooms[roomId].shuttle;
        if(!shuttle) return;

        ['osong', 'terminal', 'airport'].forEach(loc => {
          if(shuttle[loc]) {
            const names = Object.values(shuttle[loc]);
            if(names.length > 0) {
              totals[loc] += names.length;
              details[loc][roomId] = names;
            }
          }
        });
      });

      // 숫자 업데이트
      document.getElementById('total-osong').innerText = totals.osong;
      document.getElementById('total-terminal').innerText = totals.terminal;
      document.getElementById('total-airport').innerText = totals.airport;
      document.getElementById('badge-osong').innerText = totals.osong + '명';
      document.getElementById('badge-terminal').innerText = totals.terminal + '명';
      document.getElementById('badge-airport').innerText = totals.airport + '명';

      // 명단 업데이트
      renderSection('osong', details.osong);
      renderSection('terminal', details.terminal);
      renderSection('airport', details.airport);

      document.getElementById('updateTimeText').innerText =
        "최근 업데이트: " + new Date().toLocaleTimeString();
    });

    function renderSection(locId, data) {
      const container = document.getElementById(`list-${locId}`);
      container.innerHTML = "";
      const roomIds = Object.keys(data).sort();

      if(roomIds.length === 0) {
        container.innerHTML = `<div class="empty-info">신청자가 없습니다</div>`;
        return;
      }

      roomIds.forEach(roomId => {
        const names = data[roomId];
        const unit = document.createElement('div');
        unit.className = 'room-unit';
        unit.innerHTML = `
          <div class="room-unit-header">
            <span>ROOM ${roomId}</span>
            <span>${names.length}명</span>
          </div>
          <div class="names-flex">
            ${names.map(name => `<div class="name-label">${name}</div>`).join('')}
          </div>
        `;
        container.appendChild(unit);
      });
    }
  </script>
</body>
</html>
