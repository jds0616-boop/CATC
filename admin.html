<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê°•ì‚¬ ì „ìš© - CATC</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 40px; background: #222; color: white; margin: 0; }
        
        /* ìƒë‹¨ í—¤ë” */
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #555; padding-bottom: 20px; margin-bottom: 40px; }
        .header h1 { font-size: 36px; margin: 0; color: #fff; letter-spacing: -1px; }
        .logo-box { background: #fff; color: #000; padding: 10px 20px; font-weight: bold; font-size: 20px; border-radius: 5px; }

        /* ì§ˆë¬¸ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ */
        .q-card { 
            background: #333; 
            border-left: 10px solid #007bff; /* íŒŒë€ìƒ‰ í¬ì¸íŠ¸ */
            padding: 25px; 
            margin-bottom: 20px; 
            border-radius: 8px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        /* ì§ˆë¬¸ í…ìŠ¤íŠ¸ (í”„ë¦¬ì  í…Œì´ì…˜ìš© í° ê¸€ì”¨) */
        .q-text { 
            font-size: 36px; 
            font-weight: bold; 
            width: 80%; 
            line-height: 1.4; 
            word-break: break-all;
        }
        
        .q-info {
            font-size: 18px;
            color: #aaa;
            margin-top: 10px;
            font-weight: normal;
        }

        /* ìš°ì¸¡ ë²„íŠ¼ ì˜ì—­ */
        .q-actions { width: 18%; text-align: right; display: flex; flex-direction: column; align-items: flex-end; gap: 10px;}
        
        .btn-check {
            padding: 15px 30px;
            font-size: 20px;
            font-weight: bold;
            border: 2px solid #555;
            background: transparent;
            color: #aaa;
            border-radius: 50px;
            cursor: pointer;
            transition: 0.2s;
        }
        .btn-check:hover { border-color: #fff; color: #fff; }

        /* ë‹µë³€ ì™„ë£Œëœ ìƒíƒœ ë””ìì¸ */
        .completed { 
            opacity: 0.3; 
            border-left-color: #555; 
            transform: scale(0.98);
        }
        .completed .btn-check {
            background: #28a745; /* ë…¹ìƒ‰ */
            border-color: #28a745;
            color: #fff;
        }

        /* ì¢‹ì•„ìš” ë±ƒì§€ */
        .like-badge {
            display: inline-block;
            background: #ff5252;
            color: white;
            font-size: 20px;
            padding: 5px 12px;
            border-radius: 20px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>CATC êµìœ¡ê³¼ì • ì§ˆë¬¸ í”Œë«í¼</h1>
        <div class="logo-box">LOGO AREA</div>
    </div>

    <div id="instructorList">
        <!-- ì§ˆë¬¸ì´ ë“¤ì–´ì˜¤ëŠ” ê³³ -->
    </div>

    <script src="config.js"></script>
    <script>
        if (typeof db !== 'undefined') {
            db.ref('questions').on('value', (snapshot) => {
                const listDiv = document.getElementById('instructorList');
                listDiv.innerHTML = "";
                
                const data = snapshot.val();
                if(!data) {
                    listDiv.innerHTML = "<p style='font-size:24px; color:#555;'>í˜„ì¬ ë“±ë¡ëœ ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
                    return;
                }

                let items = Object.keys(data).map(key => ({ id: key, ...data[key] }));

                // â˜… ì •ë ¬ ë¡œì§ (í•µì‹¬)
                // 1ìˆœìœ„: ë‹µë³€ ì•ˆ í•œ ê²ƒ(false)ì´ ìœ„ë¡œ
                // 2ìˆœìœ„: ì¢‹ì•„ìš”(likes) ë§ì€ ìˆœì„œëŒ€ë¡œ
                // 3ìˆœìœ„: ìµœì‹ ìˆœ
                items.sort((a, b) => {
                    if (a.isDone !== b.isDone) return a.isDone ? 1 : -1; // ì™„ë£Œëœê±´ ë§¨ ë’¤ë¡œ
                    if ((b.likes || 0) !== (a.likes || 0)) return (b.likes || 0) - (a.likes || 0); // ì¢‹ì•„ìš” ë§ì€ ìˆœ
                    return b.timestamp - a.timestamp; // ìµœì‹ ìˆœ
                });

                items.forEach(item => {
                    const card = document.createElement('div');
                    card.className = `q-card ${item.isDone ? 'completed' : ''}`;
                    
                    // ì¢‹ì•„ìš”ê°€ 1ê°œ ì´ìƒì¼ ë•Œë§Œ ë±ƒì§€ í‘œì‹œ
                    const likeHtml = (item.likes > 0) ? `<span class="like-badge">ğŸ‘ ${item.likes}</span>` : '';

                    card.innerHTML = `
                        <div class="q-content" style="width:80%">
                            ${likeHtml}
                            <div class="q-text">${item.text}</div>
                        </div>
                        <div class="q-actions">
                            <button class="btn-check" onclick="toggleDone('${item.id}', ${!item.isDone})">
                                ${item.isDone ? 'ë‹µë³€ì™„ë£Œë¨' : 'âœ” ë‹µë³€ì™„ë£Œ'}
                            </button>
                        </div>
                    `;
                    listDiv.appendChild(card);
                });
            });
        }

        function toggleDone(key, newStatus) {
            db.ref('questions/' + key).update({ isDone: newStatus });
        }
    </script>
</body>
</html>