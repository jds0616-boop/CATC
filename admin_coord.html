<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>í•­ê³µê¸°ìˆ í›ˆë ¨ì› êµìœ¡ìš´ì˜ë¶€ - í†µí•© í–‰ì • ê´€ë¦¬</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <style>



/* ìˆ˜ì†¡ ìš”ì²­ ì‹œê°„ ê·¸ë¦¬ë“œ */
.trans-time-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    background: #f8fafc;
    padding: 12px;
    border-radius: 12px;
    border: 1px solid #e2e8f0;
}
.time-input-group { display: flex; flex-direction: column; gap: 5px; }
.time-input-group label { font-size: 10px; font-weight: 800; color: #64748b; }









/* [ë³€ê²½] ë¦¬ìŠ¤íŠ¸ ì¹´ë“œ - ë¶€ë“œëŸ¬ìš´ í™”ì´íŠ¸ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
.course-item-card {
    background: #ffffff; 
    border-radius: 16px; 
    display: flex; 
    align-items: center; 
    cursor: pointer; 
    margin-bottom: 12px; 
    border: 1px solid #e2e8f0; /* ì–‡ì€ íšŒìƒ‰ í…Œë‘ë¦¬ */
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.02);
    overflow: hidden;
    transition: all 0.2s ease;
}


/* ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¸ì„ ë•Œ í…Œë‘ë¦¬ê°€ ë” ê°•ì¡°ë˜ëŠ” íš¨ê³¼ */
.course-item-card:hover {
    border-color: var(--blue-main);
    background: #f8fafc;
    transform: translateX(5px); /* ì˜†ìœ¼ë¡œ ì‚´ì§ ë°€ë¦¬ëŠ” íš¨ê³¼ */
}



    .course-item-card:active { transform: scale(0.98); }
    .course-color-bar { width: 6px; height: 60px; flex-shrink: 0; }
    .course-info-content { flex: 1; padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; }
/* --- ì—¬ê¸°ê¹Œì§€ ì¶”ê°€ --- */



    :root {
      --navy-dark: #0f172a; --blue-main: #0ea5e9; --blue-deep: #0369a1;
      --green-save: #10b981; --bg-cool: #f1f5f9; --card-white: #ffffff;
      --text-dark: #1e293b; --border-blue: #e2e8f0; --danger: #ef4444;
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
      margin: 0; padding: 0; font-family: 'Pretendard', sans-serif;
      background: #cfd8e3; display: flex; justify-content: center; color: var(--text-dark);
      overflow-x: hidden;
    }
    .app-container { width: 100%; max-width: 600px; min-height: 100dvh; background: var(--bg-cool); position: relative; display: flex; flex-direction: column; box-shadow: 0 0 30px rgba(0,0,0,0.1); }
    
    /* ìƒë‹¨ë°” */
    .app-header { height: 55px; background: var(--navy-dark); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; flex-shrink: 0; border-bottom: 2px solid var(--blue-main); position: sticky; top:0; z-index: 1000; }
    .header-btn { font-size: 20px; color: #fff; cursor: pointer; border:none; background:none; }
    .header-title { color: #fff; font-size: 18px; font-weight: 900; letter-spacing: -0.5px; }

    .app-content { flex: 1; padding: 12px; display: flex; flex-direction: column; gap: 12px; overflow-y: auto; }


/* [ë³€ê²½] í° ì¹´ë“œ ë””ìì¸ - í…Œë‘ë¦¬ëŠ” ì—°í•˜ê²Œ, ê·¸ë¦¼ìëŠ” ë¶€ë“œëŸ½ê²Œ */
.section-card { 
    background: var(--card-white); 
    border-radius: 20px; 
    padding: 20px; 
    /* í…Œë‘ë¦¬ë¥¼ 1pxì— ì—°í•œ íšŒìƒ‰ìœ¼ë¡œ ë³€ê²½ */
    border: 1px solid #e2e8f0 !important; 
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.03); 
    margin-bottom: 10px;
}
    .section-title { font-size: 13px; font-weight: 800; color: var(--blue-deep); margin-bottom: 12px; display: flex; align-items: center; justify-content: flex-start; gap: 8px; }
    
    .navy-select, .navy-input { width: 100%; height: 40px; border-radius: 8px; border: 1.5px solid var(--border-blue); background: #f8fafc; padding: 0 10px; font-size: 13px; font-weight: 800; color: var(--navy-dark); outline: none; }




/* [ê°€ë…ì„± ê°•í™”] ê³µì§€ì‚¬í•­ ì…ë ¥ì°½ - ê¸€ì í¬ê¸° ë° í°íŠ¸ ê°•ì¡° */
.notice-area { 
    width: 100%; 
    min-height: 120px; /* ì…ë ¥ì°½ì„ ì¢€ ë” ì‹œì›í•˜ê²Œ í‚¤ì›€ */
    border-radius: 15px; 
    border: 1.5px solid #dbeafe !important; 
    background: #f8fafc !important; 
    padding: 20px; /* ë‚´ë¶€ ì—¬ë°±ì„ ëŠ˜ë ¤ ë‹µë‹µí•¨ í•´ì†Œ */
    
    /* ê°€ë…ì„± í•µì‹¬ ì„¤ì • */
    font-family: 'Pretendard', sans-serif; /* ê¹”ë”í•œ ê³ ë”•ì²´ */
    font-size: 18px;    /* ê¸€ì í¬ê¸° í™•ëŒ€ (ê¸°ì¡´ 14px -> 18px) */
    font-weight: 800;   /* ê¸€ì ë‘ê»˜ë¥¼ ì•„ì£¼ êµµê²Œ ì„¤ì • */
    line-height: 1.8;   /* ì¤„ ê°„ê²©ì„ ë„“ê²Œ ì£¼ì–´ ê°€ë…ì„± í™•ë³´ */
    color: #0f172a !important; /* ì™„ì „ ì§„í•œ ë‚¨ìƒ‰ìœ¼ë¡œ ëª…ì•” ëŒ€ë¹„ ê°•í™” */
    
    resize: none; 
    margin-bottom: 15px; 
    outline: none;
    transition: all 0.2s;
}

/* ê¸€ ì‘ì„± ì‹œ ì…ë ¥ì°½ì´ ë” í•˜ì–—ê³  ì„ ëª…í•˜ê²Œ ë³€í•˜ëŠ” íš¨ê³¼ */
.notice-area:focus {
    border-color: #3b82f6 !important;
    background-color: #ffffff !important;
    box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
}




.shuttle-detail-section { margin-bottom: 20px; border: 1px solid #e2e8f0; border-radius: 10px; overflow: hidden; }
.shuttle-detail-header { padding: 10px 15px; font-weight: 800; font-size: 13px; display: flex; justify-content: space-between; }
/* [ë³€ê²½] ìƒì„¸ ëª…ë‹¨ ë¦¬ìŠ¤íŠ¸ - 3ì—´ ê²©ì ì •ë ¬ (ë°”ë‘‘íŒ ëª¨ì–‘) */
.shuttle-detail-list { 
    display: grid;
    /* í™”ë©´ ë„ˆë¹„ì— ë§ì¶° 3ì¹¸ì”© ë˜‘ê°™ì´ ë‚˜ëˆ” */
    grid-template-columns: repeat(3, 1fr); 
    gap: 8px; /* ì¹¸ ì‚¬ì´ ê°„ê²© */
    padding: 15px; 
    background: #fff; 
}

/* ê°œë³„ ì´ë¦„í‘œ ìŠ¤íƒ€ì¼ */
.shuttle-detail-list span {
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    padding: 8px 2px; /* ìœ„ì•„ë˜ ì—¬ë°± */
    border-radius: 8px;
    font-size: 11.5px; /* ê¸€ìê°€ ë°•ìŠ¤ë¥¼ ë„˜ì§€ ì•Šë„ë¡ ì‚´ì§ ì¡°ì ˆ */
    font-weight: 700;
    color: #334155;
    text-align: center;
    white-space: nowrap; /* ê¸€ì ì¤„ë°”ê¿ˆ ë°©ì§€ */
    display: flex;
    align-items: center;
    justify-content: center;
}

/* ëª¨ë°”ì¼ í™”ë©´ì´ ì•„ì£¼ ì‘ì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ 2ì—´ë¡œ ìë™ ì¡°ì ˆ */
@media (max-width: 360px) {
    .shuttle-detail-list { grid-template-columns: repeat(2, 1fr); }
}

/* í…Œì´ë¸” í–‰ í˜¸ë²„ íš¨ê³¼ */
.shuttle-row-hover:hover td {
    background-color: #f8fafc !important;
    color: var(--blue-main) !important;
}



/* í•­ëª©ë³„ ì»¬ëŸ¬ */
.bg-osong { background: #fee2e2; color: #ef4444; }
.bg-terminal { background: #dbeafe; color: #3b82f6; }
.bg-airport { background: #dcfce7; color: #10b981; }
.bg-car { background: #f1f5f9; color: #64748b; }
.bg-none { background: #fef3c7; color: #d97706; }










/* ìƒí™©íŒ ê·¸ë¦¬ë“œ ì „ì²´ ë””ìì¸ - 2x2 ë°°ì¹˜ */
.global-status-grid { 
    display: grid; 
    grid-template-columns: 1fr 1fr; 
    gap: 12px; 
    width: 100%; 
    margin-bottom: 20px;
}

/* [í•µì‹¬] ëª¨ë“  ë²„íŠ¼í˜• ì¹´ë“œì˜ ê³µí†µ ê¸°ë°˜ ìŠ¤íƒ€ì¼ (ë ˆì´ì•„ì›ƒ í†µì¼) */
.dashboard-card-btn {
    height: 130px; /* ë†’ì´ ê³ ì • */
    border-radius: 20px;
    display: flex;
    flex-direction: column;
    justify-content: space-between; /* ìš”ì†Œë“¤ì„ ìƒ-ì¤‘-í•˜ë¡œ ê· ë“± ë°°ì • */
    align-items: center;
    cursor: pointer;
    transition: all 0.25s ease;
    box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    border: 1px solid rgba(255, 255, 255, 0.1); /* ì–´ë‘ìš´ ë²„íŠ¼ìš© */
    position: relative;
    overflow: hidden;
    text-align: center;
    box-sizing: border-box;
    padding: 15px 10px; /* ë‚´ë¶€ ì—¬ë°± í†µì¼ */
}

/* ë§ˆìš°ìŠ¤ ì˜¬ë ¸ì„ ë•Œ íš¨ê³¼ */
.dashboard-card-btn:hover {
    transform: translateY(-5px); 
    box-shadow: 0 12px 24px rgba(0,0,0,0.4);
}

/* ë‚´ë¶€ í…ìŠ¤íŠ¸ ë° ì•„ì´ì½˜ ì •ë°€ ìœ„ì¹˜ ê³ ì • */
.dashboard-card-btn .label { 
    font-size: 11px; 
    font-weight: 700; 
    opacity: 0.8; 
    margin-bottom: 0; 
}

.dashboard-card-btn .val { 
    font-size: 26px; 
    font-weight: 900; 
    line-height: 1;
    margin: 5px 0;
}

.dashboard-card-btn .val small { 
    font-size: 14px; 
    margin-left: 2px; 
    font-weight: 700;
}

.dashboard-card-btn i { 
    font-size: 22px; /* ì•„ì´ì½˜ í¬ê¸° í†µì¼ */
    margin-top: 5px;
}

/* [í†µì¼] ëª¨ë“  ìƒí™©íŒ ë²„íŠ¼ì„ í—¤ë”ì™€ ë™ì¼í•œ ë”¥ë¸”ë£¨ ê·¸ë¼ë°ì´ì…˜ìœ¼ë¡œ ë³€ê²½ */

/* 1ë²ˆ ì¹´ë“œ: ì „ì²´ êµìœ¡ìƒ */
.stat-dark { 
    background: linear-gradient(135deg, #003366 0%, #0055aa 100%) !important; 
    color: white !important; 
    border: 1px solid rgba(255, 255, 255, 0.2) !important; /* ì€ì€í•œ í°ìƒ‰ í…Œë‘ë¦¬ */
}
.stat-dark .val { color: #60a5fa !important; } /* ë°ì€ í•˜ëŠ˜ìƒ‰ ìˆ«ì */
.stat-dark i { color: #60a5fa !important; }

/* 2ë²ˆ ì¹´ë“œ: ì™¸ì¶œ/ì™¸ë°• */
.stat-blue { 
    background: linear-gradient(135deg, #003366 0%, #0055aa 100%) !important; 
    color: white !important; 
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
}
.stat-blue .val { color: #fbbf24 !important; } /* ë…¸ë€ìƒ‰ ìˆ«ì */
.stat-blue i { color: #fbbf24 !important; }

/* 3, 4ë²ˆ ì¹´ë“œ: í•˜ë‹¨ ì•¡ì…˜ ë²„íŠ¼ (í™”ì´íŠ¸ì—ì„œ ë”¥ë¸”ë£¨ë¡œ ë³€ê²½) */
.action-white { 
    background: linear-gradient(135deg, #003366 0%, #0055aa 100%) !important; 
    color: white !important;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
}
/* 3, 4ë²ˆ ì¹´ë“œì˜ ë‚´ë¶€ ê¸€ìì™€ ì•„ì´ì½˜ ìƒ‰ìƒ ë³´ì • */
.action-white .label { color: rgba(255, 255, 255, 0.7) !important; }
.action-white .val { color: white !important; }
.action-white .icon-pickup { color: #a5b4fc !important; } /* ì—°ë³´ë¼ìƒ‰ ì•„ì´ì½˜ */
.action-white .icon-shuttle { color: #fcd34d !important; } /* í™©ê¸ˆìƒ‰ ì•„ì´ì½˜ */





    /* ê°œë³„ ê³¼ì • í˜„í™© ë°•ìŠ¤ */
    .dashboard-split { display: flex; gap: 8px; align-items: stretch; width: 100%; }
    .col-1-3 { flex: 1; }
    .col-2-3 { flex: 2.5; }
    /* [ë³€ê²½] ìƒì„¸í˜ì´ì§€ ì…êµ í˜„í™© ë°•ìŠ¤ - ë‚¨ìƒ‰ ì‹¤ì„  ì ìš© */
.entry-box { 
    background: #f0f7ff !important; /* ì•„ì£¼ ì—°í•œ íŒŒë€ìƒ‰ ì±„ìš°ê¸° */
    border: 1px solid #dbeafe !important; /* ë°°ê²½ë³´ë‹¤ ì‚´ì§ ì§„í•œ í…Œë‘ë¦¬ */
    border-radius: 16px; 
    padding: 15px; 
    text-align: center; 
    height: 100%; 
    display: flex; 
    flex-direction: column; 
    justify-content: center; 
    cursor: pointer; 
    transition: all 0.2s ease;
}
.entry-box:hover {
    transform: translateY(-2px);
    border-color: var(--blue-main) !important;
}
    .entry-val { font-size: 24px; font-weight: 900; color: var(--navy-dark); }
    .shuttle-grid { display: flex; justify-content: space-between; gap: 4px; height: 100%; }
    .shuttle-item { flex: 1; background: #fff; border-radius: 8px; padding: 10px 2px; border: 1px solid #eef2f6; text-align: center; display: flex; flex-direction: column; justify-content: center; cursor: pointer; }
    .shuttle-item span { font-size: 10px; color: #64748b; display: block; margin-bottom: 4px; font-weight: 700; }
    .shuttle-item b { font-size: 16px; color: var(--navy-dark); font-weight: 900; }

/* í…Œì´ë¸” ë ˆì´ì•„ì›ƒ ìµœì í™” */
.navy-table { width: 100%; border-collapse: separate; border-spacing: 0; }
.navy-table th { 
    background: #f8fafc; 
    padding: 12px 8px; 
    border-bottom: 2px solid #e2e8f0; 
    color: #475569; 
    font-size: 12px; 
    font-weight: 800;
}



.navy-table th, .navy-table td { 
    padding: 14px 8px; 
    border-bottom: 1px solid #f1f5f9; 
    font-size: 13px; 
    color: #1e293b; 
    vertical-align: middle; 
    text-align: center !important; /* ê°€ë¡œ ì •ë ¬ ê°€ìš´ë° ê°•ì œ */
}




/* ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ ì¤„ ìƒ‰ìƒ ë³€ê²½ */
.navy-table tr:hover td { background-color: #f8fafc; }




/* ìƒíƒœ ë°°ì§€ ë””ìì¸ ì •ëˆ */
.badge-status {
    padding: 4px 10px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 800;
    display: inline-block;
    white-space: nowrap;
}
.badge-pending { background: #fff7ed; color: #ea580c; border: 1px solid #ffedd5; }
.badge-approved { background: #f0fdf4; color: #16a34a; border: 1px solid #dcfce7; }

/* ì·¨ì†Œ ë²„íŠ¼ ë””ìì¸ */
.btn-cancel-mini {
    background: #fff;
    color: #94a3b8;
    border: 1px solid #e2e8f0;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 10px;
    cursor: pointer;
    margin-left: 4px;
    transition: 0.2s;
}
.btn-cancel-mini:hover { background: #fee2e2; color: #ef4444; border-color: #fecaca; }








    /* ì„œëª… ì´ë¯¸ì§€(ë„ì¥) ìŠ¤íƒ€ì¼ */
    .stamp-img { height: 35px; width: auto; object-fit: contain; mix-blend-mode: multiply; filter: contrast(1.2); }

    .navy-btn { width: 100%; height: 40px; border-radius: 8px; background: var(--blue-main); color: white; border: none; font-weight: 800; font-size: 13px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; transition: 0.2s; }
    .navy-btn:active { transform: scale(0.98); opacity: 0.9; }
    .navy-btn.green { background: var(--green-save); }
    .navy-btn.red { background: var(--danger); }

    /* ì‚¬ì´ë“œ ë©”ë‰´ */
    .side-menu { position: fixed; top: 0; right: -280px; width: 280px; height: 100%; background: white; z-index: 5000; transition: 0.3s; box-shadow: -5px 0 15px rgba(0,0,0,0.1); padding: 20px; display: flex; flex-direction: column; gap: 15px; }
    .side-menu.open { right: 0; }
    .menu-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 4500; display: none; }

    /* ëª¨ë‹¬ ê³µí†µ */
    .setup-modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:6000; align-items:center; justify-content:center; padding:15px; }
    .setup-box { background:white; width:100%; max-width:500px; border-radius:24px; padding:25px; max-height:90vh; overflow-y:auto; overflow-x: hidden; position: relative; }
    .setup-label { display: block; font-size: 12px; font-weight: 800; color: #64748b; margin-bottom: 6px; }

    /* í•˜ë‹¨ í‘¸í„° */
    .app-footer { height: 50px; background: var(--navy-dark); color: #fff; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; flex-shrink: 0; font-size: 12px; }
    .footer-logo img { height: 18px !important; filter: brightness(0) invert(1); opacity: 0.8; }

    /* ì¸ì‡„ ë¡œë”© ë ˆì´ì–´ */
    .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.98); z-index: 9000; display: none; align-items: center; justify-content: center; flex-direction: column; }
    .progress-bar { width: 180px; height: 8px; background: #e2e8f0; border-radius: 10px; overflow: hidden; margin-top: 15px; }
    .progress-fill { height: 100%; background: var(--blue-main); width: 0%; transition: width 0.1s; }

    /* ê´€ë¦¬ëŒ€ì¥ ë·° (ì¤‘ì•™ ë°°ì¹˜) */
    #outingManagerView { display:none; position:fixed; top:0; left:50%; transform:translateX(-50%); width:100%; max-width:600px; height:100%; background:#f1f5f9; z-index:4000; flex-direction:column; box-shadow: 0 0 30px rgba(0,0,0,0.2); }

    @media print { .no-print { display: none !important; } #print-area { display: block !important; } .print-table { width: 100%; border-collapse: collapse; margin-top: 20px; } .print-table th, .print-table td { border: 1px solid #000; padding: 10px; text-align: center; } }
    #print-area { display: none; }




/* ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ë°°ì§€ ìŠ¤íƒ€ì¼ */
    .live-badge {
        display: inline-flex; align-items: center; gap: 5px;
        background: #f8fafc; border: 1px solid #e2e8f0;
        padding: 4px 10px; border-radius: 50px;
        font-size: 11px; font-weight: 800; color: #64748b;
    }
    .live-badge i { color: #3b82f6; font-size: 10px; }

    /* ì „ì²´ êµìœ¡ìƒ ëª…ë‹¨ ëª¨ë‹¬ ë‚´ë¶€ í…Œì´ë¸” ë³´ì • */
    .modal-scroll-area { max-height: 450px; overflow-y: auto; border: 1px solid #eee; border-radius: 12px; background: #fff; }








/* ìˆ˜ì†¡ ë¦¬ìŠ¤íŠ¸ ì „ìš© ìŠ¬ë¦¼ í…Œì´ë¸” ë””ìì¸ */
.pickup-grid-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
}

.pickup-grid-table th {
    background: #f1f5f9;
    color: #475569;
    font-size: 11px;
    font-weight: 800;
    padding: 10px 5px;
    border-bottom: 2px solid #e2e8f0;
    text-transform: uppercase;
}

.pickup-grid-table td {
    padding: 8px 5px; /* ì„¸ë¡œ ê°„ê²©ì„ ì¤„ì—¬ ìŠ¬ë¦¼í•˜ê²Œ ë§Œë“¦ */
    border-bottom: 1px solid #f1f5f9;
    font-size: 12px;
    color: #334155;
    vertical-align: middle;
    white-space: nowrap; /* ê¸€ìê°€ ì ˆëŒ€ ì¤„ë°”ê¿ˆë˜ì§€ ì•ŠìŒ */
}

/* ê³¼ì •ëª…: ë§ì¤„ì„í‘œ ì²˜ë¦¬ */
.td-course {
    max-width: 130px;
    overflow: hidden;
    text-overflow: ellipsis;
    font-weight: 700;
    color: #0369a1;
    text-align: left !important;
    padding-left: 15px !important;
}

/* ë‚ ì§œ/ì‹œê°„: ê³ ì •í­ í°íŠ¸ì™€ ê°„ê²°í•œ ë°°ì¹˜ */
.td-time {
    font-family: 'Pretendard', sans-serif;
    font-weight: 600;
    color: #1e293b;
    text-align: center;
}
.td-time span { color: #94a3b8; font-size: 10px; font-weight: 400; margin-right: 4px; }

/* ì…êµ/í‡´êµ ë°°ì§€: ì„¸ë ¨ëœ ë¼ìš´ë“œ ìº¡ìŠí˜• */
.badge-dir {
    padding: 2px 8px;
    border-radius: 20px;
    font-size: 10px;
    font-weight: 800;
}
.dir-in { background: #fff7ed; color: #c2410c; border: 1px solid #ffedd5; }
.dir-out { background: #eff6ff; color: #1d4ed8; border: 1px solid #dbeafe; }

/* ê¸°ì‚¬ ìŠ¹ì¸ ìƒíƒœ */
.status-pill {
    display: inline-flex;
    align-items: center;
    gap: 4px;
}
.dot-pending { width: 6px; height: 6px; background: #f59e0b; border-radius: 50%; display: inline-block; }
.dot-approved { width: 6px; height: 6px; background: #10b981; border-radius: 50%; display: inline-block; }

/* ì·¨ì†Œ ë§í¬í˜• ë²„íŠ¼ */
.btn-del-link {
    background: none;
    border: none;
    color: #94a3b8;
    text-decoration: underline;
    font-size: 10px;
    cursor: pointer;
    padding: 0 5px;
}
.btn-del-link:hover { color: #ef4444; }




/* ê´€ë¦¬ììš© ì‹¤ì‹œê°„ ìˆ˜ì†¡ í†¡ ë°°ê²½ */
    #pickupCardContainer {
      background: #abc1d1; /* ì¹´í†¡ ë°°ê²½ìƒ‰ */
      display: flex; flex-direction: column; gap: 15px;
      padding: 15px; border-radius: 16px; min-height: 500px;
    }

    /* ë‚ ì§œ êµ¬ë¶„ì„  */
    .chat-date-line { text-align: center; margin: 10px 0; }
    .chat-date-line span {
      background: rgba(0,0,0,0.15); color: #fff;
      padding: 5px 15px; border-radius: 20px; font-size: 11px; font-weight: 800;
    }

    /* ë§í’ì„  ê³µí†µ */
    .chat-bubble { max-width: 85%; position: relative; display: flex; flex-direction: column; margin-bottom: 5px; }
    
    /* ê¸°ì‚¬ë‹˜ ë‹µë³€ (ì™¼ìª½ - ë‚˜ì—ê²Œ ì˜¨ ë©”ì‹œì§€) */
    .chat-left { align-self: flex-start; }
    .bubble-driver {
      background: #fff; padding: 12px; border-radius: 0 12px 12px 12px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1); font-size: 13px; font-weight: 800; color: #1e293b;
    }

    /* ë‚´ê°€ ë³´ë‚¸ ìš”ì²­ (ì˜¤ë¥¸ìª½ - ë‚´ê°€ ë³´ë‚¸ ë©”ì‹œì§€) */
    .chat-right { align-self: flex-end; }
    .bubble-admin {
      background: #fee500; padding: 12px; border-radius: 12px 0 12px 12px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1); font-size: 14px; line-height: 1.5; color: #1e293b;
    }

    /* í†¡ ì–‘ì‹ ë‚´ë¶€ í…ìŠ¤íŠ¸ */
    .talk-header { font-size: 11px; color: #64748b; margin-bottom: 4px; font-weight: 800; }
    .talk-body { font-weight: 700; white-space: pre-line; }
    
    /* í†¡ í•˜ë‹¨ ê´€ë¦¬ ë„êµ¬ */
    .talk-footer {
      display: flex; justify-content: space-between; align-items: center;
      margin-top: 10px; padding-top: 8px; border-top: 1px dashed rgba(0,0,0,0.1);
    }
    .btn-cancel-talk {
      background: none; border: none; color: #ef4444; font-size: 11px; 
      font-weight: 800; text-decoration: underline; cursor: pointer;
    }

    .chat-time { font-size: 10px; color: #666; margin-top: 4px; }
    .chat-right .chat-time { align-self: flex-end; }




/* [ë³€ê²½] í‡´êµì°¨ëŸ‰ ë°•ìŠ¤ - ì—°í•œ ë¸”ë£¨ ë°°ê²½ ì±„ìš°ê¸° */
.shuttle-group-box {
    background: #f0f7ff !important; /* ë™ì¼í•œ ë¸”ë£¨ ë°°ê²½ */
    border: 1px solid #dbeafe !important; 
    border-radius: 16px;
    box-shadow: none !important;
}

.entry-box:hover, .shuttle-group-box:hover {
    background: #e0f2fe !important;
    transform: translateY(-2px);
}




/* í‡´êµ ìˆ˜ì†¡ ê·¸ë£¹ ë°•ìŠ¤ í˜¸ë²„ íš¨ê³¼ */
.shuttle-group-box:hover {
    background-color: #f8fafc !important;
    border-color: #3b82f6 !important;
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1) !important;
}
.shuttle-group-box:active {
    transform: translateY(0);
    filter: brightness(0.95);
}



/* í•˜ë‹¨ ì¤‘ì•™ í”Œë¡œíŒ… í™ˆ ë²„íŠ¼ (íŒì—… ìœ„ë¡œ ìµœìƒë‹¨ ë°°ì¹˜) */
#floatingHomeBtn {
    position: fixed;
    bottom: 75px; 
    left: 50%;
    transform: translateX(-50%); 
    background: #0f172a; 
    color: white;
    padding: 10px 25px;
    border-radius: 50px;
    display: none; 
    align-items: center;
    justify-content: center;
    gap: 10px;
    font-size: 14px;
    font-weight: 800;
    cursor: pointer;
    box-shadow: 0 5px 20px rgba(0,0,0,0.5); 
    /* íŒì—…(8000)ë³´ë‹¤ ë†’ì€ ìˆ«ìë¥¼ ì£¼ì–´ ë¬´ì¡°ê±´ ìœ„ì— ëœ¨ê²Œ í•¨ */
    z-index: 10000 !important; 
    transition: all 0.2s ease;
    border: 1.5px solid rgba(255,255,255,0.1); 
    white-space: nowrap;
}
#floatingHomeBtn:active { transform: translateX(-50%) scale(0.95); }
#floatingHomeBtn i { font-size: 16px; color: #3b82f6; }


/* íŒì—… ì—´ë ¸ì„ ë•Œ ë’·ë°°ê²½ ìŠ¤í¬ë¡¤ ë°©ì§€ í´ë˜ìŠ¤ */
body.modal-open {
    overflow: hidden !important;
    touch-action: none; /* ëª¨ë°”ì¼ í„°ì¹˜ ìŠ¤í¬ë¡¤ ë°©ì§€ */
}

/* íŒì—… ë‚´ìš©ë¬¼ ì˜ì—­ ìŠ¤í¬ë¡¤ ìµœì í™” */
.setup-box {
    overscroll-behavior: contain; /* ìŠ¤í¬ë¡¤ì´ ëì— ë‹¿ì•„ë„ ë¶€ëª¨ë¡œ ì „ë‹¬ë˜ì§€ ì•ŠìŒ */
    -webkit-overflow-scrolling: touch;
}




/* ê°•ì‚¬ìˆ˜ì†¡ íƒ­: íƒ€ì´í‹€+ë²„íŠ¼ ë¼ì¸ ì™„ë²½ í‹€ê³ ì • (ìµœì¢… ë³´ì •) */
    .sticky-transport-bar {
      position: sticky;
      /* app-contentì˜ padding 12pxë¥¼ ê°•ì œë¡œ ë¬´ì‹œí•˜ê³  ìƒë‹¨ë°”(55px) ë°”ë¡œ ë°‘ì— ë¶™ì„ */
      top: -12px; 
      z-index: 900; /* ìƒë‹¨ë°”(1000)ë³´ë‹¤ëŠ” ë‚®ê³ , ë§í’ì„ ë³´ë‹¤ëŠ” ë†’ê²Œ */
      background: #f1f5f9; /* ë’·ë°°ê²½ìƒ‰ê³¼ ë™ì¼í•˜ê²Œ (í•„ìˆ˜) */
      padding: 12px 0 8px 0; 
      margin: 0;
      width: 100%;
    }

    /* í‹€ê³ ì • ì¹´ë“œ ë””ìì¸: ì—¬ë°± ë° í…Œë‘ë¦¬ ì •ëˆ */
    .sticky-transport-bar .section-card {
      margin: 0 !important;
      border-radius: 20px;
      border: 1px solid #e2e8f0 !important;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      background: #ffffff;
    }
    
    /* ì±„íŒ…ì°½ ì»¨í…Œì´ë„ˆ: ìƒë‹¨ ê³ ì •ë°”ì™€ ê²¹ì¹˜ì§€ ì•Šê²Œ ì—¬ë°± ë¶€ì—¬ */
    #pickupCardContainer {
      background: #abc1d1;
      display: flex;
      flex-direction: column;
      gap: 15px;
      padding: 15px;
      border-radius: 16px;
      margin-top: 10px; /* ê³ ì •ë°”ì™€ì˜ ê°„ê²© */
      min-height: 70vh; /* ìŠ¤í¬ë¡¤ì„ ìœ„í•œ ì¶©ë¶„í•œ ë†’ì´ í™•ë³´ */
    }



  </style>
</head>
<body>

  <div id="loadingOverlay" class="loading-overlay">
      <div style="font-weight:900; color:var(--navy-dark);">ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ ë™ê¸°í™” ì¤‘ì…ë‹ˆë‹¤...</div>
      <div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>
  </div>

  <div class="app-container no-print">
    <div id="menuOverlay" class="menu-overlay" onclick="toggleMenu(false)"></div>
    <div id="sideMenu" class="side-menu">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h3 style="margin:0; font-size:16px; color:var(--navy-dark);">í–‰ì • ì§€ì› ë©”ë‰´</h3>
        <i class="fa-solid fa-xmark" style="cursor:pointer; font-size:22px;" onclick="toggleMenu(false)"></i>
      </div>

      <div id="side-global-menu" style="display:none; flex-direction:column; gap:12px;">
          <button class="navy-btn" style="background:#3b82f6; height:45px;" onclick="openSetupModal()">
              <i class="fa-solid fa-gear"></i> êµìœ¡ê³¼ì • ì¶”ê°€/ì„¤ì •
          </button>
      </div>

<div id="side-individual-menu" style="display:none; flex-direction:column; gap:12px;">
          <button class="navy-btn" style="background:var(--blue-deep); height:45px;" onclick="openSetupModalFromIndividual()">
              <i class="fa-solid fa-sliders"></i> í•´ë‹¹ ê³¼ì • ì„¤ì • ìˆ˜ì •
          </button>
          <div class="section-card" style="padding:10px;">
              <div class="section-title"><i class="fa-solid fa-qrcode"></i> ì¶œê²° QR ê´€ë¦¬</div>
              <div id="qrPreviewArea" style="background:#f8fafc; border:1px solid #eee; border-radius:8px; padding:10px; text-align:center;">
                  <img id="qrPreview" style="max-width:100%; max-height:120px; display:none;">
                  <div id="qrEmpty" style="font-size:11px; color:#94a3b8; padding:10px;">ë“±ë¡ëœ QR ì—†ìŒ</div>
              </div>
              <input type="file" id="qrFile" accept="image/*" style="display:none;" onchange="handleQRUpload(this)">
              <button class="navy-btn" style="background:#64748b; height:35px; font-size:11px; margin-top:10px;" onclick="document.getElementById('qrFile').click()">QR ì´ë¯¸ì§€ êµì²´</button>
          </div>
          <button class="navy-btn" style="background:#6366f1; height:45px;" onclick="openTransportModal()">
              <i class="fa-solid fa-car-side"></i> ê°•ì‚¬ ìˆ˜ì†¡ ìš”ì²­
          </button>
          <!-- ìƒí™œê´€ ë°°ì •í˜„í™© ë²„íŠ¼ ì¶”ê°€ -->
          <button class="navy-btn" style="background:#10b981; height:45px;" onclick="openDormManager()">
              <i class="fa-solid fa-bed"></i> ìƒí™œê´€ ë°°ì •í˜„í™© ì¡°íšŒ
          </button>
          <button class="navy-btn red" style="height:45px; margin-top: 10px;" onclick="resetIndividualCourse()">
              <i class="fa-solid fa-triangle-exclamation"></i> êµìœ¡ê³¼ì • ê°•ì œ ë¦¬ì…‹
          </button>
      </div>
    </div>

    <header class="app-header">
      <button class="header-btn" onclick="handleBackNav()"><i class="fa-solid fa-chevron-left"></i></button>
      <div class="header-title">í•­ê³µê¸°ìˆ í›ˆë ¨ì› êµìœ¡ìš´ì˜ë¶€</div>
      <button class="header-btn" onclick="toggleMenu(true)"><i class="fa-solid fa-bars"></i></button>
    </header>

    <main class="app-content">
<!-- [ë·° 1] ì „ì²´ ê³¼ì • í˜„í™© -->
<div id="totalStatusView" style="display:flex; flex-direction:column; gap:12px;">
    
<div class="global-status-grid">
    <!-- 1ë²ˆ ì¹´ë“œ: ì „ì²´ êµìœ¡ìƒ -->
    <div class="dashboard-card-btn stat-dark" onclick="/*í•¨ìˆ˜ë„£ê¸°*/">
        <div class="label">í•­ê¸°ì› ì „ì²´ êµìœ¡ìƒ</div>
        <div class="val"><span id="g-total-students">0</span><small>ëª…</small></div>
        <i class="fa-solid fa-users"></i>
    </div>

    <!-- 2ë²ˆ ì¹´ë“œ: ê´€ë¦¬ëŒ€ì¥ -->
    <div class="dashboard-card-btn stat-blue" onclick="openOutingManager()">
        <div class="label">ê¸ˆì¼ ì™¸ì¶œÂ·ì™¸ë°• ì‹ ì²­</div>
        <div class="val"><span id="g-today-actions">0</span><small>ê±´</small></div>
        <i class="fa-solid fa-file-signature"></i>
    </div>

    <!-- 3ë²ˆ ì¹´ë“œ: ê°•ì‚¬ í”½ì—… (ì‹ ê·œ ìˆ«ì ì¶”ê°€) -->
    <div class="dashboard-card-btn action-white" onclick="showPickupView()">
        <div class="label">ê°•ì‚¬ í”½ì—…ìš”ì²­ í˜„í™©</div>
        <div class="val"><span id="g-pickup-count">0</span><small>ê±´</small></div>
        <i class="fa-solid fa-car-side icon-pickup"></i>
    </div>

    <!-- 4ë²ˆ ì¹´ë“œ: êµìœ¡ìƒ í‡´êµ (ì‹ ê·œ ìˆ«ì ì¶”ê°€) -->
    <div class="dashboard-card-btn action-white" onclick="showStudentShuttleView()">
        <div class="label">êµìœ¡ìƒ í‡´êµ ì‹ ì²­ í˜„í™©</div>
        <div class="val"><span id="g-shuttle-count">0</span><small>ëª…</small></div>
        <i class="fa-solid fa-bus icon-shuttle"></i>
    </div>
</div>



          <div class="section-card">
              <div class="section-title"><i class="fa-solid fa-list-ul"></i> í˜„ì¬ ìš´ì˜ ì¤‘ì¸ ê³¼ì • ë¦¬ìŠ¤íŠ¸</div>
              <div id="activeCourseList" style="display:flex; flex-direction:column; gap:8px;"></div>
          </div>
          <div class="section-card">
              <div class="section-title" style="justify-content:space-between;">
                  <span><i class="fa-solid fa-calendar-check"></i> <span id="historyDateLabel">ì¡°íšŒ ì¤‘...</span></span>
                  <input type="date" id="historyDate" class="navy-select" style="width:125px; height:30px; font-size:11px;" onchange="loadActionHistory(this.value)">
              </div>
              <div style="overflow-x: auto; margin-top:10px;">
                  <table class="navy-table">
                      <thead><tr><th style="width:25%;">ê³¼ì •ëª…</th><th style="width:15%;">ì‹ ì²­ì</th><th style="width:15%;">êµ¬ë¶„</th><th style="width:25%;">ì‹œê°„</th><th style="width:20%;">ë‹´ë‹¹ í™•ì¸</th></tr></thead>
                      <tbody id="historyTableBody"></tbody>
                  </table>
              </div>
          </div>
      </div>




<!-- ê°•ì‚¬ í”½ì—… í†µí•© í˜„í™© (í‹€ê³ ì • êµ¬ì¡°) -->
<div id="pickupStatusView" class="view-card-full" style="display:none; flex-direction:column; gap:0;">
    
    <!-- ì´ ë°•ìŠ¤ê°€ ìŠ¤í¬ë¡¤ì„ ë‚´ë ¤ë„ ìƒë‹¨ë°” ë°‘ì— ë”± ê³ ì •ë©ë‹ˆë‹¤ -->
    <div class="sticky-transport-bar">
        <div class="section-card" style="padding: 15px 20px;">
            <div class="section-title" style="justify-content:space-between; margin-bottom:0;">
                <span><i class="fa-solid fa-car-side"></i> ê°•ì‚¬ ìˆ˜ì†¡ í†µí•© ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸</span>
                <button class="navy-btn" style="width:110px; height:32px; font-size:11px;" onclick="openTransportModal()">
                    <i class="fa-solid fa-plus"></i> ìˆ˜ì†¡ ì¶”ê°€ìš”ì²­
                </button>
            </div>
        </div>
    </div>

    <!-- ì±„íŒ…ì°½ (ì´ ë‚´ìš©ë§Œ ìœ„ë¡œ ì˜¬ë¼ê°€ë©° ê³ ì •ë°” ë’¤ë¡œ ì‚¬ë¼ì§) -->
    <div id="pickupCardContainer">
        <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ ë‚´ìš© -->
    </div>
</div>




      <!-- [ì‹ ê·œ ë·° 4] êµìœ¡ìƒ í‡´êµì°¨ëŸ‰ í†µí•© í˜„í™© -->
      <div id="studentShuttleView" class="view-card-full" style="display:none; flex-direction:column; gap:12px;">
          <div class="section-card">
              <div class="section-title"><i class="fa-solid fa-bus"></i> ê³¼ì •ë³„ í‡´êµì°¨ëŸ‰ ì‹ ì²­ ì´ê´„</div>
              <div style="overflow-x: auto;">
                  <table class="navy-table">
                      <thead>
                          <tr><th>ê³¼ì •ëª…</th><th>ì´ì›</th><th>ì˜¤ì†¡ì—­</th><th>í„°ë¯¸ë„</th><th>ê³µí•­</th><th>ìì°¨</th></tr>
                      </thead>
                      <tbody id="shuttleTotalTableBody">
                          <!-- JSì—ì„œ ë‚´ìš© ì±„ì›€ -->
                      </tbody>
                  </table>
              </div>
          </div>
      </div>


      <!-- [ë·° 2] ê°œë³„ ê³¼ì • ìƒì„¸ -->
      <div id="individualStatusView" style="display:none; flex-direction:column; gap:12px;">
          <div id="indCourseHeader" style="background: linear-gradient(135deg, #003366 0%, #0055aa 100%); border-radius: 12px; padding: 22px 25px; margin-bottom: 10px; color: #ffffff; box-shadow: 0 4px 12px rgba(0, 51, 102, 0.2); display: flex; flex-direction: column; gap: 12px;">
              <div style="display: flex; align-items: baseline; gap: 10px; border-bottom: 1px solid rgba(255,255,255,0.15); padding-bottom: 12px;">
                  <span style="font-weight: 900; font-size: 14px; color: #60a5fa;">ROOM <span id="ind-room-id">-</span></span>
                  <span id="ind-course-name" style="font-weight: 800; font-size: 19px;">ê³¼ì •ëª… ë¡œë”© ì¤‘...</span>
              </div>
              <div style="display: flex; flex-wrap: wrap; gap: 10px 20px; font-size: 12.5px;">
                  <div><span style="opacity: 0.6;">êµìœ¡ê¸°ê°„:</span> <span id="ind-period">-</span></div>
                  <div><span style="opacity: 0.6;">ë‹´ë‹¹êµìˆ˜:</span> <span id="ind-prof">-</span></div>
                  <div><span style="opacity: 0.6;">ê³¼ì •ë‹´ë‹¹:</span> <span id="ind-coord">-</span></div>
                  <div><span style="opacity: 0.6;">ê°•ì˜ì‹¤:</span> <span id="ind-room-loc">-</span></div>
                  <div style="width:100%; color: #fbbf24; font-weight: 800; border-top:1px solid rgba(255,255,255,0.1); padding-top:10px; margin-top:5px;">
                    <i class="fa-solid fa-crown"></i> í•™ìƒì¥: <span id="ind-leader">ì§€ì •ëœ í•™ìƒì¥ ì—†ìŒ</span>
                  </div>
              </div>
          </div>

          <div class="dashboard-split">
              <div class="col-1-3"><div class="entry-box" onclick="showEntryMemberList()"><span style="font-size:11px; font-weight:800; color:var(--blue-deep);">ì…êµ í˜„í™©</span><div class="entry-val" id="ind-entry-cnt">0<span>ëª…</span></div></div></div>
              <div class="col-2-3">
              <div class="section-card" style="height:100%; padding:10px; display:flex; flex-direction:column; justify-content:center;">
                  <div class="section-title" style="margin-bottom:8px; font-size:11px;">
                      <i class="fa-solid fa-bus"></i> í‡´êµ ì°¨ëŸ‰ ìˆ˜ìš”ì¡°ì‚¬ (ì‹¤ì‹œê°„)
                  </div>


<div class="shuttle-group-box" onclick="showShuttleApplicationDetails(currentRID)" style="background: #ffffff; border: 1.5px solid #e2e8f0; border-radius: 15px; padding: 15px; display: flex; align-items: center; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.02); height: 75px;">
    <!-- ì™¼ìª½: ì „ì²´ ì¸ì› (ê°€ì¥ í¬ê²Œ) -->
    <div style="flex: 1.2; text-align: center; border-right: 1.5px solid #f1f5f9; padding-right: 10px; display: flex; flex-direction: column; justify-content: center;">
        <span style="font-size: 11px; font-weight: 800; color: #64748b; margin-bottom: 2px;">ì´ ì‹ ì²­</span>
        <div>
            <b id="ind-shuttle-total" style="font-size: 26px; font-weight: 900; color: #3b82f6;">0</b>
            <span style="font-size: 13px; font-weight: 800; color: #3b82f6; margin-left: 2px;">ëª…</span>
        </div>
    </div>
    
    <!-- ì˜¤ë¥¸ìª½: ëª©ì ì§€ë³„ ìš”ì•½ ìˆ«ì (í•œ ì¤„ ë°°ì¹˜) -->
    <div style="flex: 3; display: flex; justify-content: space-around; padding-left: 10px; align-items: center;">
        <div style="text-align: center;">
            <span style="font-size: 10px; font-weight: 800; color: #ef4444; display: block; margin-bottom: 2px;">ì˜¤ì†¡</span>
            <b id="ind-osong" style="font-size: 16px; font-weight: 900; color: #1e293b;">0</b>
        </div>
        <div style="text-align: center;">
            <span style="font-size: 10px; font-weight: 800; color: #3b82f6; display: block; margin-bottom: 2px;">í„°ë¯¸ë„</span>
            <b id="ind-term" style="font-size: 16px; font-weight: 900; color: #1e293b;">0</b>
        </div>
        <div style="text-align: center;">
            <span style="font-size: 10px; font-weight: 800; color: #10b981; display: block; margin-bottom: 2px;">ê³µí•­</span>
            <b id="ind-air" style="font-size: 16px; font-weight: 900; color: #1e293b;">0</b>
        </div>
        <div style="text-align: center;">
            <span style="font-size: 10px; font-weight: 800; color: #64748b; display: block; margin-bottom: 2px;">ìì°¨</span>
            <b id="ind-car" style="font-size: 16px; font-weight: 900; color: #1e293b;">0</b>
        </div>
    </div>
    
    <!-- ìš°ì¸¡ ë í™”ì‚´í‘œ ì•„ì´ì½˜ -->
    <div style="color: #cbd5e1; font-size: 14px; margin-left: 5px;">
        <i class="fa-solid fa-chevron-right"></i>
    </div>
</div>
              </div>
          </div>
          </div>

          <div class="section-card">
              <div class="section-title"><i class="fa-solid fa-comment-dots"></i> ë‹´ë‹¹ ê³¼ì • ê³µì§€ (í•´ë‹¹ ê³¼ì • êµìœ¡ìƒ ê³µì§€)</div>
              <textarea id="courseNotice" class="notice-area" oninput="autoGrow(this)" placeholder="ê³µì§€ ì…ë ¥"></textarea>
              <button class="navy-btn" onclick="saveCourseNotice()">ê³¼ì • ê³µì§€ ì—…ë°ì´íŠ¸</button>
          </div>

          <div class="section-card">
              <div class="section-title"><i class="fa-solid fa-earth-asia"></i> í•­ê¸°ì› ì „ì²´ ê³µì§€ (ì„¼í„° ê³µí†µ ê³µì§€)</div>
              <textarea id="globalNotice" class="notice-area" oninput="autoGrow(this)" placeholder="ì„¼í„° ì „ì²´ ê³µì§€ ì…ë ¥"></textarea>
              <button class="navy-btn green" onclick="saveGlobalNotice()">ì „ì²´ ê³µì§€ ì—…ë°ì´íŠ¸</button>
          </div>

          <div class="section-card" style="margin-bottom: 50px;">
              <div class="section-title" style="justify-content:space-between;">
                  <span><i class="fa-solid fa-user-clock"></i> ì™¸ì¶œ/ì™¸ë°• ì‹ ì²­ì ëª…ë‹¨</span>
                  <button class="navy-btn" style="width:140px; height:32px; font-size:12px;" onclick="openOutingLedger()">ì™¸ì¶œ(ì™¸ë°•)ëŒ€ì¥</button>
              </div>
              <div style="overflow-x: auto;">
                  <table class="navy-table">
                      <thead>
                          <tr>
                              <th>ì‹ ì²­ì</th>
                              <th>êµ¬ë¶„</th>
                              <th>ì‹œê°„</th>
                              <th width="100">ë‹´ë‹¹ í™•ì¸</th>
                          </tr>
                      </thead>
                      <tbody id="indActionTableBody"></tbody>
                  </table>
              </div>
          </div>
      </div>
    </main>


<!-- í”Œë¡œíŒ… í™ˆ ë²„íŠ¼ -->
<div id="floatingHomeBtn" onclick="handleBackNav()">
    <i class="fa-solid fa-house"></i>
    <span>í™ˆìœ¼ë¡œ</span>
</div>



    <footer class="app-footer">
      <div id="footer-date">0000.00.00 00:00</div>
      <div class="footer-logo"><img src="logo.png" alt="KAC Logo"></div>
    </footer>
  </div>

  <!-- í†µí•© ê´€ë¦¬ëŒ€ì¥ ëª¨ë‹¬ -->
  <div id="outingManagerView">
      <header class="app-header">
          <button class="header-btn" onclick="closeOutingManager()"><i class="fa-solid fa-chevron-left"></i></button>
          <div class="header-title">ì™¸ì¶œ/ì™¸ë°• í†µí•© ê´€ë¦¬ ëŒ€ì¥</div>
          <button class="header-btn" onclick="openPrintModal()"><i class="fa-solid fa-print"></i></button>
      </header>
      <div style="flex:1; overflow-y:auto; padding:15px;">
          <div class="section-card">
              <div id="managerDateLabel" style="font-weight:900; margin-bottom:15px; color:var(--navy-dark); font-size:16px;">ê´€ë¦¬ í˜„í™©</div>
              <div style="overflow-x: auto;"><table class="navy-table"><thead><tr><th>ê³¼ì •ëª…</th><th>ì‹ ì²­ì</th><th>êµ¬ë¶„</th><th>ì‹œê°„</th><th width="100">ë‹´ë‹¹ í™•ì¸</th></tr></thead><tbody id="managerTableBody"></tbody></table></div>
          </div>
      </div>
  </div>

  <!-- ë‹´ë‹¹ì ë° ì„œëª… ê´€ë¦¬ ëª¨ë‹¬ -->
  <div id="coordManageModal" class="setup-modal" style="z-index: 7500;">
      <div class="setup-box" style="max-width: 450px;">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:2px solid #eee; padding-bottom:10px;">
              <h3 style="margin:0; font-size:17px; color:var(--navy-dark);"><i class="fa-solid fa-id-card-clip"></i> ë‹´ë‹¹ì ëª…ë‹¨ ë° ì„œëª… ê´€ë¦¬</h3>
              <i class="fa-solid fa-xmark" style="cursor:pointer; font-size:22px;" onclick="document.getElementById('coordManageModal').style.display='none'"></i>
          </div>
          <div id="coordListContainer" style="max-height: 250px; overflow-y: auto; margin-bottom: 15px; border:1px solid #eee; border-radius:8px; padding:10px; background:#f8fafc;"></div>
          <div style="padding:15px; background:#fff; border:1px solid #eee; border-radius:12px;">
              <label class="setup-label">ìƒˆ ë‹´ë‹¹ì ë“±ë¡ ë° ì„œëª… ì—…ë¡œë“œ</label>
              <input type="text" id="newCoordInput" class="navy-input" placeholder="ì„±í•¨ ì§ì±…" style="margin-bottom:8px;">
              <div style="display:flex; gap:5px;">
                  <input type="file" id="coordSignFile" accept="image/*" style="display:none;" onchange="coordMgr.handleFile(this)">
                  <button class="navy-btn" style="background:#64748b; flex:1;" onclick="document.getElementById('coordSignFile').click()"><i class="fa-solid fa-stamp"></i> ì„œëª… ì„ íƒ</button>
                  <button id="coordRegBtn" class="navy-btn" style="flex:1;" onclick="coordMgr.add()">ë“±ë¡í•˜ê¸°</button>
              </div>
              <div id="signPreviewArea" style="margin-top:10px; text-align:center; display:none;">
                  <span style="font-size:11px; color:#64748b;">ì„ íƒëœ ì„œëª… ë¯¸ë¦¬ë³´ê¸°:</span><br>
                  <img id="tempSignPreview" style="height:50px; border:1px solid #eee; margin-top:5px; mix-blend-mode:multiply;">
              </div>
          </div>
          <button class="navy-btn" style="margin-top:20px; background:#1e293b;" onclick="document.getElementById('coordManageModal').style.display='none'">ë‹«ê¸°</button>
      </div>
  </div>

  <!-- í†µí•© ì„¤ì • ëª¨ë‹¬ -->
  <div id="setupModal" class="setup-modal">
      <div class="setup-box" style="overflow-y: visible;">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:2px solid #eee; padding-bottom:10px;">
              <h3 style="margin:0; font-size:18px; color:var(--navy-dark);"><i class="fa-solid fa-sliders"></i> êµìœ¡ê³¼ì • í†µí•© í™˜ê²½ ì„¤ì •</h3>
              <i class="fa-solid fa-xmark" style="cursor:pointer; font-size:22px;" onclick="closeSetupModal()"></i>
          </div>
          <div style="display:flex; flex-direction:column; gap:15px;">
              <div><label class="setup-label">ëŒ€ìƒ ê°•ì˜ì‹¤ ì„ íƒ</label><select id="setup-room-select" class="navy-select" onchange="loadRoomSettings(this.value)"></select></div>
              <div><label class="setup-label">êµìœ¡ê³¼ì •ëª…</label><input type="text" id="setup-course-name" class="navy-input"></div>
              <div><label class="setup-label">êµìœ¡ ê¸°ê°„</label><div style="display:flex; gap:5px;"><input type="date" id="setup-start" class="navy-input"><input type="date" id="setup-end" class="navy-input"></div></div>
              <div><label class="setup-label">ê°•ì˜ì‹¤ ìƒì„¸ ìœ„ì¹˜</label>
                  <select id="setup-room-dropdown" class="navy-select" onchange="checkLocationDirect(this.value)">
                      <option value="">--- ì¥ì†Œ ì„ íƒ ---</option>
                      <optgroup label="í•˜ëŠ˜ê´€">
                          <option value="í•˜ëŠ˜ê´€ 1ì¸µ ëŒ€ê°•ë‹¹">í•˜ëŠ˜ê´€ 1ì¸µ ëŒ€ê°•ë‹¹</option>
                          <option value="í•˜ëŠ˜ê´€ 2ì¸µ Aê°•ì˜ì‹¤">í•˜ëŠ˜ê´€ 2ì¸µ Aê°•ì˜ì‹¤</option>
                          <option value="í•˜ëŠ˜ê´€ 2ì¸µ Bê°•ì˜ì‹¤">í•˜ëŠ˜ê´€ 2ì¸µ Bê°•ì˜ì‹¤</option>
                          <option value="í•˜ëŠ˜ê´€ 2ì¸µ Cê°•ì˜ì‹¤">í•˜ëŠ˜ê´€ 2ì¸µ Cê°•ì˜ì‹¤</option>
                          <option value="í•˜ëŠ˜ê´€ 2ì¸µ Dê°•ì˜ì‹¤">í•˜ëŠ˜ê´€ 2ì¸µ Dê°•ì˜ì‹¤</option>
                          <option value="í•˜ëŠ˜ê´€ 2ì¸µ Eê°•ì˜ì‹¤">í•˜ëŠ˜ê´€ 2ì¸µ Eê°•ì˜ì‹¤</option>
                          <option value="í•˜ëŠ˜ê´€ 2ì¸µ Fê°•ì˜ì‹¤">í•˜ëŠ˜ê´€ 2ì¸µ Fê°•ì˜ì‹¤</option>
                          <option value="í•˜ëŠ˜ê´€ 2ì¸µ Gê°•ì˜ì‹¤">í•˜ëŠ˜ê´€ 2ì¸µ Gê°•ì˜ì‹¤</option>
                      </optgroup>
                      <optgroup label="êµ­ì œë™">
                          <option value="êµ­ì œë™ 1ì¸µ ì„¸ë¯¸ë‚˜í™€">êµ­ì œë™ 1ì¸µ ì„¸ë¯¸ë‚˜í™€</option>
                          <option value="êµ­ì œë™ 1ì¸µ Aê°•ì˜ì‹¤">êµ­ì œë™ 1ì¸µ Aê°•ì˜ì‹¤</option>
                          <option value="êµ­ì œë™ 1ì¸µ Bê°•ì˜ì‹¤">êµ­ì œë™ 1ì¸µ Bê°•ì˜ì‹¤</option>
                          <option value="êµ­ì œë™ 2ì¸µ í•­ê³µì •ë³´í†µì‹ ì‹œì„¤ ì‹¤ìŠµì‹¤">êµ­ì œë™ 2ì¸µ ì‹¤ìŠµì‹¤</option>
                          <option value="êµ­ì œë™ 2ì¸µ VOR/DME/TACAN ì‹¤ìŠµì‹¤">êµ­ì œë™ 2ì¸µ VOR/DME/TACAN</option>
                      </optgroup>
                      <option value="direct">ì§ì ‘ ì…ë ¥</option>
                  </select>
                  <input type="text" id="setup-location-direct" class="navy-input" style="margin-top:5px; display:none;" placeholder="ìœ„ì¹˜ ì§ì ‘ ì‘ì„±">
              </div>
              <div><label class="setup-label">ë‹´ë‹¹ êµìˆ˜</label><select id="setup-prof-select" class="navy-select"></select></div>
              <div>
                  <label class="setup-label">ê³¼ì • ìš´ì˜ ë‹´ë‹¹ì (í–‰ì •)</label>
                  <div style="display:flex; gap:5px;">
                      <select id="setup-coord-select" class="navy-select"></select>
                      <button class="navy-btn" style="width:45px; background:#1e293b;" onclick="coordMgr.openManage()"><i class="fa-solid fa-gear"></i></button>
                  </div>
              </div>
          </div>
          <div style="display:flex; gap:10px; margin-top:25px;"><button class="navy-btn" style="background:#64748b; flex:1;" onclick="closeSetupModal()">ì·¨ì†Œ</button><button class="navy-btn" style="background:var(--blue-main); flex:2;" onclick="saveIntegratedSettings()">ì„¤ì • ì €ì¥ ë° ê³¼ì • ê°œì„¤</button></div>
      </div>
  </div>













<!-- ìˆ˜ì†¡ ìš”ì²­ ëª¨ë‹¬ (ì™•ë³µ/í¸ë„ í†µí•© ë²„ì „) -->
  <div id="transportModal" class="setup-modal" style="z-index: 8000;">
      <div class="setup-box" style="max-width: 450px;">
          <div style="background:#6366f1; color:white; padding:18px; display:flex; justify-content:space-between; align-items:center; margin:-25px -25px 20px -25px; border-radius:24px 24px 0 0;">
              <h3 style="margin:0; font-size:17px;">ğŸš– ê°•ì‚¬ ìˆ˜ì†¡ ìš”ì²­ ê´€ë¦¬</h3>
              <i class="fa-solid fa-xmark" style="cursor:pointer; font-size:20px;" onclick="closeTransportModal()"></i>
          </div>
          <div style="display:flex; flex-direction:column; gap:15px;">
              <!-- ê³¼ì • ì„ íƒ ì˜ì—­ -->
              <div id="reqCourseSelectRow" style="display:none;">
                  <label class="setup-label">ëŒ€ìƒ êµìœ¡ê³¼ì •</label>
                  <select id="reqCourseRID" class="navy-select">
                      <option value="">--- ê³¼ì •ì„ ì„ íƒí•˜ì„¸ìš” ---</option>
                  </select>
              </div>

              <div>
                  <label class="setup-label">í”½ì—… ì¥ì†Œ</label>
                  <select id="reqLoc" class="navy-select" onchange="updateTransLabels()">
    <option value="ì˜¤ì†¡ì—­">ì˜¤ì†¡ì—­</option>
    <option value="ì²­ì£¼í„°ë¯¸ë„">ì²­ì£¼í„°ë¯¸ë„</option>
    <option value="ì²­ì£¼ê³µí•­">ì²­ì£¼ê³µí•­</option>
</select>
              </div>

              <div>
                  <label class="setup-label">ìˆ˜ì†¡ ë‚ ì§œ</label>
                  <input type="date" id="reqDate" class="navy-input">
              </div>
              
              <!-- ì‹œê°„ ì…ë ¥ ì˜ì—­ (ë¼ë²¨ ID í¬í•¨ ë²„ì „) -->
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; background: #f8fafc; padding: 12px; border-radius: 12px; border: 1.5px solid #e2e8f0;">
                  <div style="display: flex; flex-direction: column; gap: 5px;">
                      <!-- ì—¬ê¸°ì— id="labelTo" ê°€ ë°˜ë“œì‹œ ìˆì–´ì•¼ í•©ë‹ˆë‹¤ -->
                      <label id="labelTo" style="font-size: 10px; font-weight: 800; color: #64748b;">ì˜¤ì†¡ì—­ â†’ í•­ê¸°ì›</label>
                      <input type="time" id="reqTimeTo" class="navy-input">
                  </div>
                  <div style="display: flex; flex-direction: column; gap: 5px;">
                      <!-- ì—¬ê¸°ì— id="labelFrom" ì´ ë°˜ë“œì‹œ ìˆì–´ì•¼ í•©ë‹ˆë‹¤ -->
                      <label id="labelFrom" style="font-size: 10px; font-weight: 800; color: #64748b;">í•­ê¸°ì› â†’ ì˜¤ì†¡ì—­</label>
                      <input type="time" id="reqTimeFrom" class="navy-input">
                  </div>
              </div>
              <p style="font-size:10px; color:#94a3b8; margin:-5px 0 0 5px;">* í¸ë„ ìš”ì²­ ì‹œ í•œìª½ ì‹œê°„ë§Œ ì…ë ¥í•˜ì„¸ìš”.</p>

              <input type="text" id="reqProf" class="navy-input" placeholder="ê°•ì‚¬ëª… ì„±í•¨">
              <input type="tel" id="reqPhone" class="navy-input" placeholder="ê°•ì‚¬ ì—°ë½ì²˜">
              
              <button class="navy-btn" style="background:#6366f1; height:45px;" onclick="submitTransReq()">ìˆ˜ì†¡ ì˜ˆì•½ ë“±ë¡</button>
              
              <div style="margin-top:10px; border-top:1px dashed #eee; padding-top:15px;">
                  <span style="font-weight:800; font-size:12px; color:#ef4444;">ğŸ“œ ì‹¤ì‹œê°„ ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸</span>
                  <div id="courseReqList" style="margin-top:10px; max-height:150px; overflow-y:auto;"></div>
              </div>
          </div>
          <button class="navy-btn" style="margin-top:15px; background:#64748b;" onclick="closeTransportModal()">ë‹«ê¸°</button>
      </div>
  </div>





<!-- ìƒí™œê´€ ë°°ì •í˜„í™© ëª¨ë‹¬ -->
  <div id="dormManagerModal" class="setup-modal">
      <div class="setup-box" style="max-width: 500px;">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:2px solid #eee; padding-bottom:10px;">
              <h3 style="margin:0; font-size:17px; color:var(--navy-dark);"><i class="fa-solid fa-bed"></i> ê³¼ì • ìƒí™œê´€ ë°°ì • ëª…ë‹¨</h3>
              <i class="fa-solid fa-xmark" style="cursor:pointer; font-size:22px;" onclick="document.getElementById('dormManagerModal').style.display='none'"></i>
          </div>
          <div style="max-height: 400px; overflow-y: auto;">
              <table class="navy-table">
                  <thead>
                      <tr><th>ì„±í•¨</th><th>ë’·ìë¦¬</th><th>ìƒí™œê´€</th><th>í˜¸ì‹¤</th></tr>
                  </thead>
                  <tbody id="dormTableBody"></tbody>
              </table>
          </div>
          <button class="navy-btn" style="margin-top:20px; background:#64748b;" onclick="document.getElementById('dormManagerModal').style.display='none'">ë‹«ê¸°</button>
      </div>
  </div>




<!-- ì „ì²´ êµìœ¡ìƒ í†µí•© ëª…ë‹¨ ëª¨ë‹¬ -->
  <div id="totalStudentListModal" class="setup-modal">
      <div class="setup-box" style="max-width: 500px;">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:2px solid #eee; padding-bottom:10px;">
              <h3 style="margin:0; font-size:17px; color:var(--navy-dark);"><i class="fa-solid fa-users-list"></i> í•­ê¸°ì› ì „ì²´ êµìœ¡ìƒ ëª…ë‹¨</h3>
              <i class="fa-solid fa-xmark" style="cursor:pointer; font-size:22px;" onclick="document.getElementById('totalStudentListModal').style.display='none'"></i>
          </div>
          <div class="modal-scroll-area">
              <table class="navy-table">
                  <thead style="position:sticky; top:0; z-index:10;">
                      <tr><th>ê³¼ì •</th><th>ì„±í•¨</th><th>ì—°ë½ì²˜(ë’·ìë¦¬)</th></tr>
                  </thead>
                  <tbody id="totalStudentListBody"></tbody>
              </table>
          </div>
          <button class="navy-btn" style="margin-top:20px; background:#64748b;" onclick="document.getElementById('totalStudentListModal').style.display='none'">ë‹«ê¸°</button>
      </div>
  </div>


<!-- --- ì—¬ê¸°ì„œë¶€í„° ì¶”ê°€ (ì¸ì‡„ ê³¼ì • ì„ íƒ ëª¨ë‹¬) --- -->
  <div id="printSelectModal" class="setup-modal" style="z-index: 9500;">
      <div class="setup-box" style="max-width: 400px;">
          <div style="text-align:center; margin-bottom:20px;">
              <h3 style="margin:0; font-size:18px; color:var(--navy-dark);">ì¸ì‡„í•  ê³¼ì •ì„ ì„ íƒí•˜ì„¸ìš”</h3>
              <p style="font-size:12px; color:#64748b; margin-top:5px;">ì„ íƒ ì‹œ í•´ë‹¹ ê³¼ì •ì˜ ê´€ë¦¬ëŒ€ì¥ìœ¼ë¡œ ì—°ê²°ë©ë‹ˆë‹¤.</p>
          </div>
          <div id="printCourseList" style="display:flex; flex-direction:column; gap:8px; max-height:300px; overflow-y:auto;">
              <!-- ìš´ì˜ì¤‘ì¸ ê³¼ì • ë²„íŠ¼ì´ ì—¬ê¸°ì— ìƒì„±ë¨ -->
          </div>
          <button class="navy-btn" style="margin-top:20px; background:#64748b;" onclick="document.getElementById('printSelectModal').style.display='none'">ë‹«ê¸°</button>
      </div>
  </div>
<!-- --- ì—¬ê¸°ê¹Œì§€ ì¶”ê°€ --- -->





  <!-- ì¸ì‡„ ë ˆì´ì–´ -->
  <div id="print-area">
      <div style="text-align:center; border-bottom:3px double #333; padding-bottom:10px; margin-bottom:30px;"><h1 style="margin:0; font-size:28px;">ì™¸ì¶œ/ì™¸ë°• ì‹ ì²­ êµìœ¡ìƒ í˜„í™©</h1><p id="print-info-text" style="margin:10px 0; font-weight:700;"></p></div>
      <table class="print-table"><thead><tr><th width="40">No</th><th width="150">ê³¼ì •ëª…</th><th width="60">êµ¬ë¶„</th><th width="80">ì„±ëª…</th><th width="130">ë¹„ìƒì—°ë½ì²˜</th><th width="90">ì‹ ì²­ì‹œê°„</th><th width="100">ë‹´ë‹¹ í™•ì¸</th></tr></thead><tbody id="printBody"></tbody></table>
  </div>





<!-- [ì‹ ê·œ] ì™¸ì¶œ/ì™¸ë°• ìƒì„¸ ë‚´ì—­ íŒì—… -->
<div id="actionDetailModal" class="setup-modal" style="z-index: 8000;">
    <div class="setup-box" style="max-width: 400px; padding: 0; overflow: hidden;">
        <div style="background: var(--navy-dark); color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center;">
            <h3 style="margin: 0; font-size: 18px;"><i class="fa-solid fa-circle-info"></i> ì‹ ì²­ ìƒì„¸ ì •ë³´</h3>
            <i class="fa-solid fa-xmark" style="cursor: pointer; font-size: 20px;" onclick="document.getElementById('actionDetailModal').style.display='none'"></i>
        </div>
        <div id="actionDetailContent" style="padding: 20px; display: flex; flex-direction: column; gap: 15px;">
            <!-- ìƒì„¸ ì •ë³´ê°€ ì—¬ê¸°ì— ë“¤ì–´ê°‘ë‹ˆë‹¤ -->
        </div>
        <div style="padding: 15px; background: #f8fafc; border-top: 1px solid #eee;">
            <button class="navy-btn" style="background: #64748b;" onclick="document.getElementById('actionDetailModal').style.display='none'">ë‹«ê¸°</button>
        </div>
    </div>
</div>












  <script src="config.js"></script>
  <script>
    let globalAllData = {}; let currentRID = ""; let selectedDate = getTodayString(); let transDir = "";


// [ìµœì¢… ë³´ê°•] ê³¼ì • ìš´ì˜ ë‹´ë‹¹ì(í–‰ì •) ë° ì„œëª… ê´€ë¦¬ ê°ì²´ (ìˆ˜ì • ê¸°ëŠ¥ ì¶”ê°€ ë²„ì „)
const coordMgr = {
    list: [],
    tempSign: "",
    editingKey: null, // í˜„ì¬ ìˆ˜ì • ì¤‘ì¸ ë‹´ë‹¹ìì˜ ê³ ìœ  í‚¤ ì €ì¥
    
    // 1. ì´ˆê¸°í™”
    init: async function() {
        const ref = firebase.database().ref('system/coordinators');
        const snap = await ref.once('value');
        if (!snap.exists()) {
            const initial = ["ë°±ìœ ë¯¼ ê³¼ì¥", "ì£¼ì˜ë¯¸ ê³¼ì¥", "ì¥ì˜ê·¼ ê³¼ì¥", "ì±„ìœ ë€ ì£¼ì„", "ê¹€ì§€ì€ ì£¼ì„", "ë°•ì°¬ë¯¸ ì£¼ì„"];
            for (let name of initial) { await ref.push({ name: name, sign: "" }); }
        }
        ref.on('value', s => {
            const data = s.val() || {};
            this.list = Object.keys(data).map(k => ({ key: k, ...data[k] }));
            this.renderSelects();    
            this.renderManageList(); 
        });
    },

    // 2. ì„¤ì •ì°½ ë“œë¡­ë‹¤ìš´ ê°±ì‹ 
    renderSelects: function() {
        const sel = document.getElementById('setup-coord-select'); 
        if(!sel) return;
        const curValue = sel.value;
        sel.innerHTML = '<option value="">--- ë‹´ë‹¹ì ì„ íƒ ---</option>';
        this.list.forEach(c => {
            const opt = new Option(c.name, c.name);
            if(c.name === curValue) opt.selected = true;
            sel.add(opt);
        });
    },

    // 3. ê´€ë¦¬ì°½ ë¦¬ìŠ¤íŠ¸ ê·¸ë¦¬ê¸° (í´ë¦­ ì‹œ ìˆ˜ì • ëª¨ë“œ ì—°ê²°)
    renderManageList: function() {
        const div = document.getElementById('coordListContainer'); 
        if(!div) return;
        if(this.list.length === 0) {
            div.innerHTML = "<div style='text-align:center; padding:20px; color:#94a3b8;'>ë“±ë¡ëœ ë‹´ë‹¹ìê°€ ì—†ìŠµë‹ˆë‹¤.</div>";
            return;
        }

        div.innerHTML = this.list.map(c => `
            <div style="display:flex; justify-content:space-between; padding:12px; border-bottom:1px solid #eee; align-items:center; background:#fff; margin-bottom:5px; border-radius:8px; cursor:pointer; border:${this.editingKey === c.key ? '2px solid var(--blue-main)' : '1px solid #eee'}" 
                 onclick="coordMgr.startEdit('${c.key}')">
                <div style="display:flex; align-items:center; gap:12px; flex:1;">
                    <span style="font-weight:800; color:var(--navy-dark);">${c.name}</span>
                    ${c.sign ? `<img src="${c.sign}" style="height:35px; mix-blend-mode:multiply; border:1px solid #eee; border-radius:4px;">` : `<span style="font-size:10px; color:#94a3b8;">(ì„œëª… ë¯¸ë“±ë¡)</span>`}
                </div>
                <i class="fa-solid fa-circle-xmark" style="color:var(--danger); cursor:pointer; font-size:20px; padding:5px;" 
                   onclick="event.stopPropagation(); coordMgr.delete('${c.key}')"></i>
            </div>`).join('');
    },

    // 4. ìˆ˜ì • ëª¨ë“œ ì‹œì‘ (ì´ë¦„ í´ë¦­ ì‹œ í˜¸ì¶œ)
    startEdit: function(key) {
        const item = this.list.find(c => c.key === key);
        if(!item) return;

        this.editingKey = key;
        document.getElementById('newCoordInput').value = item.name;
        
        // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
        document.getElementById('coordRegBtn').innerHTML = '<i class="fa-solid fa-check"></i> ìˆ˜ì •ì™„ë£Œ';
        document.getElementById('coordRegBtn').style.background = "var(--green-save)";

        // ê¸°ì¡´ ì„œëª…ì´ ìˆë‹¤ë©´ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
        if(item.sign) {
            this.tempSign = item.sign;
            document.getElementById('tempSignPreview').src = item.sign;
            document.getElementById('signPreviewArea').style.display = 'block';
        } else {
            this.tempSign = "";
            document.getElementById('signPreviewArea').style.display = 'none';
        }
        
        this.renderManageList(); // ì„ íƒëœ í•­ëª© ê°•ì¡°ë¥¼ ìœ„í•´ ì¬ëœë”ë§
        document.getElementById('newCoordInput').focus();
    },

    // 5. ì…ë ¥ê°’ ì´ˆê¸°í™”
    resetFields: function() {
        this.editingKey = null;
        this.tempSign = "";
        document.getElementById('newCoordInput').value = "";
        document.getElementById('coordRegBtn').innerHTML = 'ë“±ë¡í•˜ê¸°';
        document.getElementById('coordRegBtn').style.background = "var(--blue-main)";
        document.getElementById('signPreviewArea').style.display = 'none';
        document.getElementById('coordSignFile').value = "";
        this.renderManageList();
    },

    // 6. íŒŒì¼ ì„ íƒ ì²˜ë¦¬
    handleFile: function(input) {
        const file = input.files[0]; 
        if(!file) return;
        const reader = new FileReader();
        reader.onload = (e) => { 
            this.tempSign = e.target.result;
            document.getElementById('tempSignPreview').src = e.target.result;
            document.getElementById('signPreviewArea').style.display = 'block';
        };
        reader.readAsDataURL(file);
    },

    // 7. ë“±ë¡ ë˜ëŠ” ìˆ˜ì • ì‹¤í–‰
    add: async function() {
        const name = document.getElementById('newCoordInput').value.trim();
        if(!name) return alert("ì„±í•¨ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
        
        try {
            const data = { name: name, sign: this.tempSign };
            
            if(this.editingKey) {
                // ìˆ˜ì • ëª¨ë“œ
                await firebase.database().ref(`system/coordinators/${this.editingKey}`).update(data);
                alert("ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
            } else {
                // ì‹ ê·œ ë“±ë¡ ëª¨ë“œ
                await firebase.database().ref('system/coordinators').push(data);
                alert("ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
            }
            this.resetFields();
        } catch(e) {
            alert("ì €ì¥ ì˜¤ë¥˜: " + e.message);
        }
    },

    // 8. ì‚­ì œ ì²˜ë¦¬
    delete: async function(k) {
        if(confirm("ì´ ë‹´ë‹¹ìë¥¼ ëª…ë‹¨ì—ì„œ ì‚­ì œí• ê¹Œìš”?")) {
            await firebase.database().ref(`system/coordinators/${k}`).remove();
            if(this.editingKey === k) this.resetFields();
        }
    },

    openManage: function() {
        this.resetFields(); // ì—´ ë•Œë§ˆë‹¤ ì´ˆê¸°í™”
        document.getElementById('coordManageModal').style.display = 'flex';
    }
};







// [ìˆ˜ì •] ë³´ì•ˆ ì²´í¬ ê¸°ëŠ¥ì´ ì¶”ê°€ëœ ì´ˆê¸°í™” í•¨ìˆ˜
    function init() {
        // --- ë³´ì•ˆ ì²´í¬ ì‹œì‘ ---
        const sessionKey = 'kac_session_coord'; // êµìœ¡ìš´ì˜ë¶€ ì „ìš© í‚¤
        const savedSession = localStorage.getItem(sessionKey);
        const FIVE_HOURS = 5 * 60 * 60 * 1000;

        let isAccessDenied = true;

        if (savedSession) {
            const data = JSON.parse(savedSession);
            if (Date.now() - data.time < FIVE_HOURS) {
                isAccessDenied = false; // 5ì‹œê°„ ì´ë‚´ì´ë¯€ë¡œ í—ˆìš©
            }
        }

        if (isAccessDenied) {
            alert("ë³´ì•ˆ ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.\ní¬í„¸ í˜ì´ì§€ì—ì„œ ë‹¤ì‹œ ì ‘ì†í•´ì£¼ì„¸ìš”.");
            location.href = 'potal.html';
            return;
        }
        // --- ë³´ì•ˆ ì²´í¬ ë ---

        // ê¸°ì¡´ ë°ì´í„° ë¡œë“œ ë¡œì§ ìœ ì§€
        firebase.database().ref('courses').on('value', snap => {
            globalAllData = snap.val() || {};
            updateGlobalStatus(); 
            renderCourseSelectors(); 
            renderTotalHistory();
            if(currentRID) updateIndividualView();
            if(document.getElementById('outingManagerView').style.display === 'flex') renderOutingManager();
        });
        
        firebase.database().ref('system/globalNotice').on('value', s => { 
            const el = document.getElementById('globalNotice'); if(el) { el.value = s.val() || ""; autoGrow(el); }
        });
        
        document.getElementById('historyDate').value = selectedDate;
        handleRoomSelection();
        coordMgr.init();
    }









// [3. ì „ì²´ í˜„í™©íŒ ì‹¤ì‹œê°„ ì§‘ê³„ ë° ëª…ë‹¨ íŒì—…] - 4ê°œ ë²„íŠ¼ ìˆ˜ì¹˜ ëª¨ë‘ ë°˜ì˜
function updateGlobalStatus() {
    let globalList = []; 
    let todayA = 0; 
    let totalShuttle = 0; // êµìœ¡ìƒ í‡´êµ ì¸ì› í•©ê³„
    const tStr = getTodayString();

    // 1. êµìœ¡ê³¼ì • ë°ì´í„°ë¥¼ ëŒë©° í•™ìƒìˆ˜, ì™¸ì¶œê±´ìˆ˜, í‡´êµì‹ ì²­ìˆ˜ ì§‘ê³„
    Object.keys(globalAllData).forEach(rid => {
        const room = globalAllData[rid];
        const cName = room.settings?.courseName || `[ë¯¸ì„¤ì •] Room ${rid}`;
        
        // [í•­ê¸°ì› ì „ì²´ êµìœ¡ìƒ ì§‘ê³„]
        if (room.students) { 
            Object.values(room.students).forEach(s => {
                if (s && s.name && s.name !== "undefined" && s.name.trim() !== "") {
                    const cleanPhone = (s.phone || "0000").replace(/[^0-9]/g, "");
                    const last4 = cleanPhone.length >= 4 ? cleanPhone.slice(-4) : cleanPhone;
                    globalList.push({
                        courseName: cName,
                        name: s.name.trim(),
                        phone: last4
                    });
                }
            });
        }
        
        // [ê¸ˆì¼ ì™¸ì¶œ/ì™¸ë°• ê±´ìˆ˜ ì§‘ê³„]
        if (room.admin_actions?.[tStr]) {
            todayA += Object.keys(room.admin_actions[tStr]).length;
        }

        // [êµìœ¡ìƒ í‡´êµ ì‹ ì²­ ì´ ì¸ì› ì§‘ê³„]
        if (room.shuttle?.requests) {
            totalShuttle += Object.keys(room.shuttle.requests).length;
        }
    });

    // 2. ì¤‘ë³µ ì œê±° (ì´ë¦„ + ë’·ìë¦¬ ê¸°ì¤€) - 1ë²ˆ ë²„íŠ¼ìš©
    const uniqueSet = new Set();
    const filteredList = globalList.filter(item => {
        const id = `${item.name}_${item.phone}`;
        if(uniqueSet.has(id)) return false;
        uniqueSet.add(id);
        return true;
    });

    // 3. ê°•ì‚¬ í”½ì—… ìš”ì²­ ê±´ìˆ˜ ê°€ì ¸ì˜¤ê¸° (ì „ì—­ ë°ì´í„°) - 3ë²ˆ ë²„íŠ¼ìš©
    firebase.database().ref('system/transport_requests').once('value', snap => {
        const pickupData = snap.val() || {};
        const pickupCount = Object.keys(pickupData).length;
        
        // í™”ë©´ ìˆ«ì ì—…ë°ì´íŠ¸ (ID ê¸°ì¤€)
        if(document.getElementById('g-total-students')) document.getElementById('g-total-students').innerText = uniqueSet.size;
        if(document.getElementById('g-today-actions')) document.getElementById('g-today-actions').innerText = todayA;
        if(document.getElementById('g-pickup-count')) document.getElementById('g-pickup-count').innerText = pickupCount;
        if(document.getElementById('g-shuttle-count')) document.getElementById('g-shuttle-count').innerText = totalShuttle;
    });

    // 4. [1ë²ˆ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸] - ì „ì²´ êµìœ¡ìƒ ëª…ë‹¨ íŒì—… ìœ ì§€
    const studentBtn = document.getElementById('g-total-students')?.closest('.dashboard-card-btn');
    if(studentBtn) {
        studentBtn.onclick = function() {
            const modal = document.getElementById('totalStudentListModal');
            const tbody = document.getElementById('totalStudentListBody');
            
            filteredList.sort((a,b) => a.courseName.localeCompare(b.courseName) || a.name.localeCompare(b.name));
            
            tbody.innerHTML = filteredList.length ? filteredList.map(s => `
                <tr>
                    <td style="font-size:11px; color:var(--blue-deep); font-weight:800; text-align:left; padding-left:10px;">${s.courseName}</td>
                    <td style="font-weight:800;">${s.name}</td>
                    <td style="color:#94a3b8;">${s.phone}</td>
                </tr>
            `).join('') : '<tr><td colspan="3" style="padding:20px;">ì…êµìƒ ì—†ìŒ</td></tr>';
            
            modal.style.display = 'flex';
        };
    }
} // updateGlobalStatus ë









// [ìˆ˜ì •] ê°œë³„ ê³¼ì • ìƒì„¸ ë·°: í–‰ ì „ì²´ í´ë¦­ ë²”ìœ„ í™•ëŒ€ ë° UI ë³´ì •
function updateIndividualView() {
    const room = globalAllData[currentRID]; 
    if (!room) return;

    document.getElementById('ind-room-id').innerText = currentRID;
    document.getElementById('ind-course-name').innerText = room.settings?.courseName || "ê³¼ì •ëª… ë¯¸ì„¤ì •";
    document.getElementById('ind-period').innerText = room.settings?.period || "-";
    document.getElementById('ind-prof').innerText = (room.status?.professorName || "-") + " êµìˆ˜";
    document.getElementById('ind-coord').innerText = room.settings?.coordinatorName || "-";
    document.getElementById('ind-room-loc').innerText = room.settings?.roomDetailName || "-";

    let leaderTxt = "ì§€ì •ëœ í•™ìƒì¥ ì—†ìŒ";
    if(room.students) {
        const leaders = Object.values(room.students).filter(s => s.isLeader === true);
        if(leaders.length > 0) {
            leaderTxt = leaders.map(l => `${l.name} [${l.phone || 'ì—°ë½ì²˜ ë¯¸ë“±ë¡'}]`).join(' / ');
        }
    }
    document.getElementById('ind-leader').innerText = leaderTxt;

    const students = Object.values(room.students || {}).filter(s => s.name && s.name !== "undefined");
    const uniqueSize = (new Set(students.map(s => `${s.name.trim()}_${(s.phone||"").replace(/-/g,'').trim()}`))).size;
    document.getElementById('ind-entry-cnt').innerHTML = `${uniqueSize}<span>ëª…</span>`;
    
    const requests = room.shuttle?.requests || {};
    const items = Object.values(requests);
    document.getElementById('ind-shuttle-total').innerText = items.length;
    document.getElementById('ind-osong').innerText = items.filter(i => i.type === 'osong').length;
    document.getElementById('ind-term').innerText = items.filter(i => i.type === 'terminal').length;
    document.getElementById('ind-air').innerText = items.filter(i => i.type === 'airport').length;
    document.getElementById('ind-car').innerText = items.filter(i => i.type === 'car').length;

    const actionTbody = document.getElementById('indActionTableBody');
    const today = getTodayString();
    const actions = room.admin_actions?.[today] || {};
    const actionItems = Object.keys(actions).map(k=>({...actions[k], token:k})).sort((a,b)=>a.timestamp-b.timestamp);
    
    actionTbody.innerHTML = actionItems.length ? actionItems.map(a => {
        const isSigned = a.confirmed === true;
        const returnBadge = a.returned ? `<span style="display:inline-block; background:#10b981; color:white; padding:2px 8px; border-radius:4px; font-size:10px; margin-left:5px; font-weight:800; vertical-align:middle;">ë³µê·€ì™„ë£Œ</span>` : "";
        const btnText = isSigned ? "ì„œëª…ì·¨ì†Œ" : "ì„œëª…";
        const btnStyle = isSigned ? "background:#94a3b8; color:#fff; border:none;" : "background:var(--blue-main); color:#fff; border:none;";
        const dataStr = encodeURIComponent(JSON.stringify(a));
        
        // ë²„íŠ¼ì„ ì œì™¸í•œ í–‰ ì „ì²´ë¥¼ í´ë¦­ ì˜ì—­ìœ¼ë¡œ ì„¤ì •
        const rowClickAction = `onclick="showActionDetail('${dataStr}')" style="cursor:pointer;"`;

        return `<tr>
            <td ${rowClickAction} style="font-weight:800; text-align:center;">${a.name}${returnBadge}</td>
            <td ${rowClickAction} style="color:${a.type==='outing'?'#ea580c':'#dc2626'}; font-weight:800; text-align:center;">${a.type==='outing'?'ì™¸ì¶œ':'ì™¸ë°•'}</td>
            <td ${rowClickAction} style="text-align:center;">${new Date(a.timestamp).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}</td>
            <td><button onclick="toggleConfirm('${currentRID}', '${today}', '${a.token}', ${isSigned})" style="${btnStyle} border-radius:5px; width:100%; height:35px; display:flex; align-items:center; justify-content:center; font-weight:800; cursor:pointer; font-size:11px; margin: 0 auto;">${btnText}</button></td>
        </tr>`;
    }).join('') : '<tr><td colspan="4" style="padding:20px; color:#94a3b8; text-align:center;">ì‹ ì²­ ëª…ë‹¨ ì—†ìŒ</td></tr>';
    
    document.getElementById('courseNotice').value = room.coordNotice || ""; 
}






    // [5. ì„œëª… ì—°ë™ ë° ì‹¤ì‹œê°„ ì²˜ë¦¬]
async function toggleConfirm(rid, date, token, currentStatus) {
    // 1. í˜„ì¬ ì„ íƒëœ ê³¼ì • ë‹´ë‹¹ì ì •ë³´ë¥¼ ê°€ì ¸ì˜´ (ì˜ˆ: ì£¼ì˜ë¯¸ ê³¼ì¥)
    const coordName = globalAllData[rid]?.settings?.coordinatorName || "ë‹´ë‹¹ì"; 
    
    // 2. ë¯¸ë¦¬ ë“±ë¡ëœ ë‹´ë‹¹ì ë¦¬ìŠ¤íŠ¸ì—ì„œ í•´ë‹¹ ì´ë¦„ì˜ 'ë„ì¥ ì´ë¯¸ì§€'ê°€ ìˆëŠ”ì§€ ì°¾ìŒ
    // (ì´ë¯¸ ë„ì¥ ì´ë¯¸ì§€ë¥¼ coordMgr ë“±ì—ì„œ ê´€ë¦¬í•˜ê³  ìˆë‹¤ê³  ê°€ì •)
    const coordinator = coordMgr.list.find(c => c.name === coordName);
    const signImg = coordinator ? coordinator.sign : ""; // ë„ì¥ ì´ë¯¸ì§€(Base64)

    if (!currentStatus) {
        // [ìŠ¹ì¸í•  ë•Œ] ì´ë¦„ê³¼ ì´ë¯¸ì§€ë¥¼ ë™ì‹œì— ì €ì¥
        await firebase.database().ref(`courses/${rid}/admin_actions/${date}/${token}`).update({
            confirmed: true,
            confirmedBy: coordName, // ì„±í•¨/ì§ê¸‰
            confirmedBySign: signImg // ë„ì¥ ì´ë¯¸ì§€
        });
        alert("âœ… ì„œëª…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
    } else {
        // [ì·¨ì†Œí•  ë•Œ] ë°ì´í„° ì‚­ì œ
        await firebase.database().ref(`courses/${rid}/admin_actions/${date}/${token}`).update({
            confirmed: false,
            confirmedBy: null,
            confirmedBySign: null
        });
    }
}







// [ìˆ˜ì •] ê°•ì‚¬ ìˆ˜ì†¡ ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜
function openTransportModal() { 
    toggleMenu(false); 
    document.getElementById('transportModal').style.display = "flex"; 
    document.getElementById('reqDate').value = getTodayString(); 
    
    const row = document.getElementById('reqCourseSelectRow');
    const sel = document.getElementById('reqCourseRID');

    sel.innerHTML = '<option value="">--- ê³¼ì •ì„ ì„ íƒí•˜ì„¸ìš” ---</option>';
    Object.keys(globalAllData).forEach(rid => {
        const room = globalAllData[rid];
        if (room.status && room.status.roomStatus === 'active') {
            const courseName = room.settings?.courseName || `Room ${rid}`;
            const opt = new Option(courseName, rid);
            sel.add(opt);
        }
    });

    if (currentRID) {
        row.style.display = "none";
        sel.value = currentRID;
    } else {
        row.style.display = "block";
        sel.value = "";
    }

    // [ì¤‘ìš”] ì—´ë¦´ ë•Œ í˜„ì¬ ì„ íƒëœ ì¥ì†Œì— ë§ì¶° ë¼ë²¨ì„ ì—…ë°ì´íŠ¸í•¨
    updateTransLabels(); 
    loadCourseTransList(); 
}









// ì„ íƒí•œ ì¥ì†Œ(ì˜¤ì†¡ì—­, í„°ë¯¸ë„ ë“±)ì— ë”°ë¼ ì…ë ¥ì°½ ë¼ë²¨ì„ ì¦‰ì‹œ ë°”ê¾¸ëŠ” í•¨ìˆ˜
  function updateTransLabels() {
    const loc = document.getElementById('reqLoc').value;
    const toLabel = document.getElementById('labelTo');
    const fromLabel = document.getElementById('labelFrom');
    
    if(toLabel && fromLabel) {
        toLabel.innerText = `${loc} â†’ í•­ê¸°ì›`;
        fromLabel.innerText = `í•­ê¸°ì› â†’ ${loc}`;
    }
  }







// [ìˆ˜ì •] ìˆ˜ì†¡ ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ ë¡œë“œ í•¨ìˆ˜ (ê°œë³„ê³¼ì •/ì „ì²´í˜„í™© ëª¨ë‘ ëŒ€ì‘)
  function loadCourseTransList() {
    const div = document.getElementById('courseReqList'); 
    if(!div) return;

    firebase.database().ref('system/transport_requests').on('value', snap => {
        const allData = snap.val() || {}; 
        let myList = Object.keys(allData).map(key => ({ id: key, ...allData[key] }));

        // [í•µì‹¬ ìˆ˜ì •] 
        // 1. ê°œë³„ ê³¼ì • ìƒì„¸í˜ì´ì§€ì—ì„œ ì—´ì—ˆì„ ë•Œ: í•´ë‹¹ ê³¼ì •(currentRID) ê²ƒë§Œ í•„í„°ë§
        // 2. ì „ì²´ í˜„í™© í˜ì´ì§€ì—ì„œ ì—´ì—ˆì„ ë•Œ: ëª¨ë“  ê³¼ì •ì˜ ìˆ˜ì†¡ ë‚´ì—­ì„ ë‹¤ ë³´ì—¬ì¤Œ
        if (currentRID) {
            myList = myList.filter(req => req.courseRID === currentRID);
        }

        if (myList.length === 0) { 
            div.innerHTML = "<div style='color:#94a3b8; text-align:center; padding:15px; font-size:12px;'>ì˜ˆì•½ ë‚´ì—­ ì—†ìŒ</div>"; 
            return; 
        }

        // ë‚ ì§œì™€ ì‹œê°„ ìˆœìœ¼ë¡œ ì •ë ¬
        myList.sort((a, b) => (a.date + a.time).localeCompare(b.date + b.time));

        div.innerHTML = myList.map(r => {
            // ì „ì²´ í˜„í™©ì—ì„œ ë³¼ ë•Œ ì–´ë–¤ ê³¼ì •ì¸ì§€ ì•Œ ìˆ˜ ìˆë„ë¡ ê³¼ì •ëª… ì¶”ì¶œ
            const roomInfo = globalAllData[r.courseRID];
            const cName = roomInfo?.settings?.courseName || `Room ${r.courseRID}`;

            return `
                <div style="background:#f8fafc; border:1px solid #e2e8f0; padding:10px; border-radius:8px; display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                    <div style="font-size:12px; line-height:1.4;">
                        <div style="font-size:10px; color:#64748b; font-weight:800; margin-bottom:2px;">[${cName}]</div>
                        <b style="color:var(--blue-deep);">${r.date} ${r.time}</b><br>
                        <span style="font-weight:800;">${r.prof}</span> ê°•ì‚¬ë‹˜ (${r.dir})
                    </div>
                    <button onclick="deleteTrans('${r.id}')" style="background:#fee2e2; color:#ef4444; border:none; padding:6px 10px; border-radius:6px; font-size:11px; cursor:pointer; font-weight:800;">ì‚­ì œ</button>
                </div>`;
        }).join('');
    });
  }






// [ìˆ˜ì •] ìˆ˜ì†¡ ìš”ì²­ ë“±ë¡ í•¨ìˆ˜ (ì™•ë³µ/í¸ë„ ìë™ ì²˜ë¦¬)
async function submitTransReq() {
    const rid = document.getElementById('reqCourseRID').value;
    const loc = document.getElementById('reqLoc').value;
    const date = document.getElementById('reqDate').value;
    const timeTo = document.getElementById('reqTimeTo').value;   // ì…êµ ì‹œê°„
    const timeFrom = document.getElementById('reqTimeFrom').value; // í‡´êµ ì‹œê°„
    const prof = document.getElementById('reqProf').value.trim();
    const phone = document.getElementById('reqPhone').value.trim();

    if(!rid) return alert("ëŒ€ìƒ êµìœ¡ê³¼ì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
    if(!date || !prof) return alert("ë‚ ì§œì™€ ê°•ì‚¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    if(!timeTo && !timeFrom) return alert("ìµœì†Œ í•œ ê°œì˜ ìˆ˜ì†¡ ì‹œê°„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

    try {
        const requests = [];

        // 1. ì…êµ(ì¥ì†Œ->ì›) ë°ì´í„° ìƒì„±
        if(timeTo) {
            requests.push({
                courseRID: rid,
                dir: `${loc}â†’í•­ê¸°ì›`,
                date,
                time: timeTo,
                prof,
                phone,
                status: 'pending',
                timestamp: firebase.database.ServerValue.TIMESTAMP
            });
        }

        // 2. í‡´êµ(ì›->ì¥ì†Œ) ë°ì´í„° ìƒì„±
        if(timeFrom) {
            requests.push({
                courseRID: rid,
                dir: `í•­ê¸°ì›â†’${loc}`,
                date,
                time: timeFrom,
                prof,
                phone,
                status: 'pending',
                timestamp: firebase.database.ServerValue.TIMESTAMP
            });
        }

        // Firebaseì— ìˆœì°¨ì ìœ¼ë¡œ ì €ì¥
        for(let req of requests) {
            await firebase.database().ref('system/transport_requests').push(req);
        }

        alert(`âœ… ${requests.length}ê±´ì˜ ìˆ˜ì†¡ ì˜ˆì•½ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        
        // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
        document.getElementById('reqTimeTo').value = "";
        document.getElementById('reqTimeFrom').value = "";
        document.getElementById('reqProf').value = "";
        document.getElementById('reqPhone').value = "";
        
        loadCourseTransList(); 
    } catch(e) {
        alert("ì €ì¥ ì˜¤ë¥˜: " + e.message);
    }
}








// [ìˆ˜ì •] ìŠ¹ì¸ ì—¬ë¶€ì™€ ìƒê´€ì—†ì´ 'ì·¨ì†Œ' ì²˜ë¦¬ ê°€ëŠ¥í•˜ë„ë¡ ë³€ê²½
async function deleteTrans(id) { 
    const msg = "í•´ë‹¹ ìˆ˜ì†¡ ìš”ì²­ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nê¸°ì‚¬ë‹˜ê»˜ë„ ì·¨ì†Œ ì•Œë¦¼ì´ ì „ë‹¬ë˜ë©° ê¸°ë¡ì´ ë‚¨ìŠµë‹ˆë‹¤.";
    if(confirm(msg)) {
        await firebase.database().ref(`system/transport_requests/${id}`).update({
            status: 'cancelled'
        });
        alert("ì·¨ì†Œ ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
    }
}



function setTransDir(d) { 
        const loc = document.getElementById('reqLoc').value; 
        const btnTo = document.getElementById('btnTransTo'); 
        const btnFrom = document.getElementById('btnTransFrom'); 
        if(d === 'to') { 
            transDir = `${loc}â†’í•­ê¸°ì›`; 
            btnTo.style.background = "var(--blue-main)"; 
            btnTo.style.color = "#fff"; 
            btnFrom.style.background = "#fff"; 
            btnFrom.style.color = "#64748b"; 
        } else { 
            transDir = `í•­ê¸°ì›â†’${loc}`; 
            btnFrom.style.background = "var(--blue-main)"; 
            btnFrom.style.color = "#fff"; 
            btnTo.style.background = "#fff"; 
            btnTo.style.color = "#64748b"; 
        } 
    }

function updateTransDirButtons() { 
        transDir = ""; 
        const loc = document.getElementById('reqLoc').value; // í˜„ì¬ ì„ íƒëœ ì¥ì†Œ(ì˜¤ì†¡ì—­ ë“±)
        const btnTo = document.getElementById('btnTransTo');
        const btnFrom = document.getElementById('btnTransFrom');
        
        // 1. ì¥ì†Œâ†’í•­ê¸°ì› ë²„íŠ¼ ê¸€ì ë° ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
        if(btnTo) {
            btnTo.style.background = "#fff"; 
            btnTo.style.color = "#64748b"; 
            btnTo.style.border = "1.5px solid #e2e8f0";
            btnTo.innerHTML = `<i class="fa-solid fa-car"></i> ${loc}â†’í•­ê¸°ì›`;
        }
        
        // 2. í•­ê¸°ì›â†’ì¥ì†Œ ë²„íŠ¼ ê¸€ì ë° ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
        if(btnFrom) {
            btnFrom.style.background = "#fff"; 
            btnFrom.style.color = "#64748b"; 
            btnFrom.style.border = "1.5px solid #e2e8f0";
            btnFrom.innerHTML = `<i class="fa-solid fa-car"></i> í•­ê¸°ì›â†’${loc}`;
        }
    }



// [ìµœì¢…] í™ˆ/ë’¤ë¡œê°€ê¸° í´ë¦­ ì‹œ ëª¨ë“  ìƒíƒœ í•´ì œ ë° ìŠ¤í¬ë¡¤ ì ê¸ˆ í•´ì œ
function handleBackNav() { 
    // ëª¨ë“  íŒì—… ë‹«ê¸°
    const allModals = [
        'totalStudentListModal', 'dormManagerModal', 'coordManageModal', 
        'setupModal', 'transportModal', 'shuttleDetailModal', 
        'actionDetailModal', 'printSelectModal'
    ];
    
    let isModalClosed = false;
    allModals.forEach(id => {
        const modal = document.getElementById(id);
        if(modal && modal.style.display === 'flex') {
            modal.style.display = 'none';
            isModalClosed = true;
        }
    });

    // íŒì—…ì„ ë‹«ì„ ë•Œ ë°°ê²½ ìŠ¤í¬ë¡¤ ì°¨ë‹¨ í•´ì œ
    document.body.classList.remove('modal-open');

    if(isModalClosed) return;

    const outingManager = document.getElementById('outingManagerView');
    if(outingManager && outingManager.style.display === 'flex') {
        outingManager.style.display = 'none';
        return;
    }

    const pickupView = document.getElementById('pickupStatusView');
    const shuttleView = document.getElementById('studentShuttleView');
    const individualView = document.getElementById('individualStatusView');

    if ( (pickupView && pickupView.style.display === "flex") || 
         (shuttleView && shuttleView.style.display === "flex") || 
         (currentRID !== "") ) {
        
        currentRID = ""; 
        if(pickupView) pickupView.style.display = "none";
        if(shuttleView) shuttleView.style.display = "none";
        if(individualView) individualView.style.display = "none";
        
        const totalView = document.getElementById('totalStatusView');
        if(totalView) totalView.style.display = "flex";
        
        handleRoomSelection();
    } else {
        location.href = 'potal.html';
    }
}




// [ìˆ˜ì •] í™”ë©´ ì„ íƒ ë° í”Œë¡œíŒ… ë²„íŠ¼ ë…¸ì¶œ ì œì–´
function handleRoomSelection() { 
    const isInd = (currentRID !== ""); 
    const homeBtn = document.getElementById('floatingHomeBtn');

    // ëª¨ë“  ë·°ë¥¼ ì¼ë‹¨ ìˆ¨ê¹€
    document.getElementById('totalStatusView').style.display = "none"; 
    document.getElementById('individualStatusView').style.display = "none"; 
    document.getElementById('pickupStatusView').style.display = "none";
    document.getElementById('studentShuttleView').style.display = "none";
    
    document.getElementById('side-global-menu').style.display = isInd ? "none" : "flex"; 
    document.getElementById('side-individual-menu').style.display = isInd ? "flex" : "none"; 

    if(isInd) { 
        // ìƒì„¸ í˜ì´ì§€ ëª¨ë“œ (ë²„íŠ¼ ë³´ì„)
        document.getElementById('individualStatusView').style.display = "flex";
        if(homeBtn) homeBtn.style.display = "flex";
        updateIndividualView(); 
        updateQRPreview(); 
    } else {
        // ì „ì²´ í˜„í™©íŒ ëª¨ë“œ (ë²„íŠ¼ ìˆ¨ê¹€)
        document.getElementById('totalStatusView').style.display = "flex";
        if(homeBtn) homeBtn.style.display = "none";
    }
}





function renderCourseSelectors() {
    const list = document.getElementById('activeCourseList');
    const setupRoom = document.getElementById('setup-room-select');
    if (!list || !setupRoom) return;

    list.innerHTML = "";
    setupRoom.innerHTML = '<option value="">ê°•ì˜ì‹¤ ì„ íƒ (A~Z)</option>';

    // ê³¼ì •ë³„ë¡œ ë¶€ì—¬í•  ì»¬ëŸ¬ ë°°ì—´
    const barColors = ['#0ea5e9', '#10b981', '#6366f1', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899'];

    for (let i = 65; i <= 90; i++) {
        const rid = String.fromCharCode(i);
        const room = globalAllData[rid];

        // 1. ì„¤ì •ì°½ìš© ë“œë¡­ë‹¤ìš´ ì˜µì…˜ ìƒì„±
        let label = `Room ${rid}`;
        if (room?.status?.roomStatus === 'active') {
            label += ` [ì‚¬ìš©ì¤‘ - ${room.status.professorName || 'ë¯¸ì •'}]`;
        }
        setupRoom.add(new Option(label, rid));

        // 2. ë©”ì¸ ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ ìƒì„± (ì‚¬ìš©ì¤‘ì¸ ë°©ë§Œ)
        if (room?.status?.roomStatus === 'active') {
            const cName = room.settings?.courseName || rid;
            const coordName = room.settings?.coordinatorName || "ë‹´ë‹¹ ë¯¸ì§€ì •";
            const color = barColors[i % barColors.length]; // ì•ŒíŒŒë²³ ìˆœì„œëŒ€ë¡œ ì»¬ëŸ¬ ë°°ì •

            const card = document.createElement('div');
            card.className = "course-item-card";
            card.onclick = () => {
                currentRID = rid;
                handleRoomSelection();
            };

            card.innerHTML = `
                <div class="course-color-bar" style="background: ${color};"></div>
                <div class="course-info-content">
                    <div style="display:flex; flex-direction:column; gap:2px;">
                        <span style="font-size:11px; color:${color}; font-weight:800;">ROOM ${rid}</span>
                        <span style="font-weight:800; font-size:15px; color:var(--navy-dark);">${cName}</span>
                    </div>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <span style="font-size:12px; color:#64748b; font-weight:700;">${coordName}</span>
                        <i class="fa-solid fa-chevron-right" style="color:#cbd5e1; font-size:12px;"></i>
                    </div>
                </div>
            `;
            list.appendChild(card);
        }
    }
}




// [ìˆ˜ì •] ì¤‘ë³µ ì•„ì´ì½˜ ì œê±° ë° ì œëª©-ë°°ì§€ ì™„ë²½ í•œ ì¤„ ì •ë ¬
function renderTotalHistory() {
    const tbody = document.getElementById('historyTableBody');
    const label = document.getElementById('historyDateLabel');
    if(!tbody || !label) return;

    const d = new Date(selectedDate);
    const dateText = `${d.getMonth() + 1}/${d.getDate()}`;
    
    // HTMLì— ì´ë¯¸ ì•„ì´ì½˜ì´ ìˆìœ¼ë¯€ë¡œ JSì—ì„œëŠ” ì•„ì´ì½˜ì„ ë¹¼ê³  í…ìŠ¤íŠ¸ì™€ ë°°ì§€ë§Œ ë„£ìŠµë‹ˆë‹¤.
    // display: inline-flexë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜†ì— ìˆëŠ” ì•„ì´ì½˜ê³¼ ë†’ì´ë¥¼ ë§ì¶¥ë‹ˆë‹¤.
    label.innerHTML = `
        <span style="display:inline-flex; align-items:center; gap:8px; vertical-align:middle;">
            <span style="white-space:nowrap; font-weight:800; font-size:14px; color:var(--navy-bg);">ë‹¹ì¼(${dateText}) ì™¸ì¶œÂ·ì™¸ë°• ëª…ë‹¨</span>
            <div class="live-badge" style="white-space:nowrap; padding:2px 8px; font-size:10px; display:inline-flex; align-items:center; height:20px;">
                <i class="fa-solid fa-sync fa-spin" style="color:#3b82f6; margin-right:4px;"></i> ì‹¤ì‹œê°„
            </div>
        </span>
    `;

    tbody.innerHTML = "";
    let list = [];
    Object.keys(globalAllData).forEach(rid => {
        const actions = globalAllData[rid].admin_actions?.[selectedDate];
        if(actions) {
            Object.keys(actions).forEach(token => {
                list.push({
                    ...actions[token], 
                    rid: rid, 
                    token: token,
                    cName: globalAllData[rid].settings?.courseName || rid
                });
            });
        }
    });

    if(list.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" style="padding:40px; color:#94a3b8; text-align:center; font-size:13px;">ì˜¤ëŠ˜ ì‹ ì²­ëœ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        return;
    }

    list.sort((a,b) => a.timestamp - b.timestamp).forEach(a => {
        const isSigned = a.confirmed === true;
        const returnBadge = a.returned ? `<span style="display:inline-block; white-space:nowrap; background:#10b981; color:white; padding:2px 8px; border-radius:4px; font-size:10px; margin-left:5px; font-weight:800; vertical-align:middle;">ë³µê·€</span>` : "";
        const btnText = isSigned ? "ì·¨ì†Œ" : "ì„œëª…";
        const btnStyle = isSigned ? "background:#94a3b8; color:#fff; border:none;" : "background:var(--blue-main); color:#fff; border:none;";

        const dataStr = encodeURIComponent(JSON.stringify(a));
        // í–‰ ì „ì²´ í´ë¦­ì„ ìœ„í•œ ì„¤ì • (ì„œëª… ë²„íŠ¼ ì œì™¸)
        const rowClickAction = `onclick="showActionDetail('${dataStr}')" style="cursor:pointer;"`;

        tbody.innerHTML += `
            <tr>
                <td ${rowClickAction} style="text-align:center; font-size:11px; color:var(--blue-deep); font-weight:700;">${a.cName.substring(0,6)}..</td>
                <td ${rowClickAction} style="font-weight:800; text-align:center;">${a.name}${returnBadge}</td>
                <td ${rowClickAction} style="color:${a.type==='outing'?'#ea580c':'#dc2626'}; font-weight:800; text-align:center;">${a.type==='outing'?'ì™¸ì¶œ':'ì™¸ë°•'}</td>
                <td ${rowClickAction} style="text-align:center; font-size:11px; color:#94a3b8;">${new Date(a.timestamp).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}</td>
                <td>
                    <button onclick="toggleConfirm('${a.rid}', '${selectedDate}', '${a.token}', ${isSigned})" 
                            style="${btnStyle} border-radius:6px; width:100%; height:32px; display:flex; align-items:center; justify-content:center; font-weight:800; cursor:pointer; font-size:11px; margin: 0 auto;">
                        ${btnText}
                    </button>
                </td>
            </tr>`;
    });
}








    // [ìˆ˜ì •] í†µí•© ê´€ë¦¬ëŒ€ì¥ ì—´ê¸° (í™ˆ ë²„íŠ¼ í‘œì‹œ ì¶”ê°€)
function openOutingManager() { 
    document.getElementById('outingManagerView').style.display = 'flex'; 
    const homeBtn = document.getElementById('floatingHomeBtn');
    if(homeBtn) homeBtn.style.display = "flex"; // í™ˆ ë²„íŠ¼ ë³´ì´ê²Œ í•¨
    renderOutingManager(); 
}
    function closeOutingManager() { document.getElementById('outingManagerView').style.display = 'none'; }
    function renderOutingManager() { const tbody = document.getElementById('managerTableBody'); const label = document.getElementById('managerDateLabel'); label.innerText = `${selectedDate} í†µí•© ê´€ë¦¬ í˜„í™©`; tbody.innerHTML = ""; let list = []; Object.keys(globalAllData).forEach(rid => { const actions = globalAllData[rid].admin_actions?.[selectedDate]; if(actions) Object.keys(actions).forEach(token => list.push({ ...actions[token], rid, token, cName: globalAllData[rid].settings?.courseName || rid })); }); if(list.length === 0) { tbody.innerHTML = '<tr><td colspan="5" style="padding:40px; color:#94a3b8; text-align:center;">ë‚´ì—­ ì—†ìŒ</td></tr>'; return; } list.sort((a,b) => a.timestamp - b.timestamp).forEach(a => { const isSigned = a.confirmed === true; const btnContent = isSigned ? `<img src="${a.confirmedBySign}" class="stamp-img" style="height:32px;">` : "ì„œëª…í•˜ê¸°"; const btnStyle = isSigned ? "background: #f1f5f9; color: #94a3b8; border: 1px solid #e2e8f0;" : "background: var(--blue-main); color: #fff; border: none;"; tbody.innerHTML += `<tr><td style="width:30%; font-size:10px; text-align:center;">${a.cName}</td><td style="width:18%; font-weight:800; text-align:center;">${a.name}</td><td style="width:12%; color:${a.type==='outing'?'#ea580c':'#dc2626'}; font-weight:800; text-align:center;">${a.type==='outing'?'ì™¸ì¶œ':'ì™¸ë°•'}</td><td style="width:20%; font-size:10px; text-align:center;">${new Date(a.timestamp).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}</td><td style="width:20%; text-align:center;"><button onclick="toggleConfirm('${a.rid}', '${selectedDate}', '${a.token}', ${isSigned})" style="${btnStyle} border-radius:5px; padding:2px 0; font-size:10px; cursor:pointer; width:100%; height:38px; display:flex; align-items:center; justify-content:center; font-weight:800;">${btnContent}</button></td></tr>`; }); }
    function openSetupModal() { toggleMenu(false); document.getElementById('setupModal').style.display = "flex"; }
    function openSetupModalFromIndividual() { document.getElementById('setup-room-select').value = currentRID; loadRoomSettings(currentRID); toggleMenu(false); document.getElementById('setupModal').style.display = "flex"; }
    async function loadRoomSettings(rid) { const room = globalAllData[rid]; if(!room) return; document.getElementById('setup-course-name').value = room.settings?.courseName || ""; document.getElementById('setup-prof-select').value = room.status?.professorName || ""; document.getElementById('setup-coord-select').value = room.settings?.coordinatorName || ""; if(room.settings?.period?.includes(" ~ ")) { const p = room.settings.period.split(" ~ "); document.getElementById('setup-start').value = p[0]; document.getElementById('setup-end').value = p[1]; } const loc = room.settings?.roomDetailName || ""; const dropdown = document.getElementById('setup-room-dropdown'); let found = false; for(let i=0; i<dropdown.options.length; i++) { if(dropdown.options[i].value === loc) { dropdown.selectedIndex = i; found = true; break; } } if(!found && loc) { dropdown.value = "direct"; document.getElementById('setup-location-direct').value = loc; document.getElementById('setup-location-direct').style.display = "block"; } else { document.getElementById('setup-location-direct').style.display = "none"; } }
    async function saveIntegratedSettings() { const rid = document.getElementById('setup-room-select').value; const name = document.getElementById('setup-course-name').value.trim(); const start = document.getElementById('setup-start').value; const end = document.getElementById('setup-end').value; const prof = document.getElementById('setup-prof-select').value; const coord = document.getElementById('setup-coord-select').value; const dropLoc = document.getElementById('setup-room-dropdown').value; const loc = (dropLoc === 'direct') ? document.getElementById('setup-location-direct').value.trim() : dropLoc; if(!rid || !name || !start || !end || !prof || !loc) return alert("í•„ìˆ˜ í•­ëª© ì…ë ¥ í•„ìš”"); const updates = {}; updates[`courses/${rid}/settings/courseName`] = name; updates[`courses/${rid}/settings/period`] = `${start} ~ ${end}`; updates[`courses/${rid}/status/professorName`] = prof; updates[`courses/${rid}/settings/coordinatorName`] = coord; updates[`courses/${rid}/settings/roomDetailName`] = loc; updates[`courses/${rid}/status/roomStatus`] = "active"; await firebase.database().ref().update(updates).then(()=>alert("ì €ì¥ ì™„ë£Œ")); closeSetupModal(); }
// [ë³´ì•ˆ ê°•í™”] ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ í™•ì¸ í›„ êµìœ¡ê³¼ì • ê°•ì œ ë¦¬ì…‹ ì‹¤í–‰
async function resetIndividualCourse() {
    if (!currentRID) return alert("ë¨¼ì € ë¦¬ì…‹í•  êµìœ¡ ê³¼ì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");

    // 1. í•´ë‹¹ ê³¼ì •ì˜ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„œë²„ì—ì„œ ê°€ì ¸ì˜´
    const snap = await firebase.database().ref(`courses/${currentRID}/settings/password`).once('value');
    const dbPw = snap.val() || btoa("7777"); // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ 7777 (ì•”í˜¸í™”ë¨)

    // 2. ì‚¬ìš©ìì—ê²Œ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ìš”ì²­
    const userInput = prompt("ğŸš¨ [ì£¼ì˜] ëª¨ë“  ë°ì´í„°(ëª…ë‹¨, ì‹ ì²­ë‚´ì—­ ë“±)ê°€ ì‚­ì œë©ë‹ˆë‹¤.\nê³„ì†í•˜ì‹œë ¤ë©´ ì´ ê³¼ì •ì˜ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

    if (!userInput) return; // ì…ë ¥ ì•ˆ í•˜ê±°ë‚˜ ì·¨ì†Œ ëˆ„ë¥´ë©´ ì¤‘ë‹¨

    // 3. ë¹„ë°€ë²ˆí˜¸ ëŒ€ì¡° (ì…ë ¥ê°’ì„ Base64ë¡œ ë³€í™˜í•˜ì—¬ ë¹„êµ)
    if (btoa(userInput) === dbPw) {
        // ë¹„ë°€ë²ˆí˜¸ê°€ ë§ì„ ê²½ìš° ìµœì¢… í™•ì¸
        if (!confirm("ì •ë§ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ì ˆëŒ€ë¡œ ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë©° ëª¨ë“  êµìœ¡ìƒì´ í‡´ì¶œë©ë‹ˆë‹¤.")) return;

        const rPath = `courses/${currentRID}`;
        const updates = {};
        
        // ì´ˆê¸°í™”í•  ë°ì´í„° í•­ëª©ë“¤
        updates[`${rPath}/students`] = null;
        updates[`${rPath}/admin_actions`] = null;
        updates[`${rPath}/shuttle`] = null;
        updates[`${rPath}/questions`] = null;
        updates[`${rPath}/coordNotice`] = null;
        updates[`${rPath}/notice`] = null;
        updates[`${rPath}/expectedStudents`] = null;
        updates[`${rPath}/attendanceQR`] = null;
        
        // ìƒíƒœ ë³€ê²½ (ë¹„ì–´ìˆìŒìœ¼ë¡œ ì „í™˜ ë° ê°•ì œ í‡´ì¶œ í‚¤ ë°œì†¡)
        updates[`${rPath}/status/roomStatus`] = "idle";
        updates[`${rPath}/status/resetKey`] = "KICK_COORD_" + Date.now();

        try {
            await firebase.database().ref().update(updates);
            alert("âœ… êµìœ¡ê³¼ì •ì´ ì •ìƒì ìœ¼ë¡œ ì´ˆê¸°í™” ë° ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
            currentRID = ""; // ì„ íƒ í•´ì œ
            handleRoomSelection(); // ì²« í™”ë©´ìœ¼ë¡œ ë³µê·€
        } catch (e) {
            alert("ì˜¤ë¥˜ ë°œìƒ: " + e.message);
        }
    } else {
        // ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ì„ ë•Œ
        alert("âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ˆê¸°í™”ê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.");
    }
}
  

// ì™¸ì¶œì™¸ë°• ëŒ€ì¥ ìƒˆì°½ ì—´ê¸° í•¨ìˆ˜
function openOutingLedger() {
    if(!currentRID) {
        alert("ë¨¼ì € ì™¼ìª½ ë¦¬ìŠ¤íŠ¸ì—ì„œ êµìœ¡ ê³¼ì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
        return;
    }
    // ìƒˆ ì°½ìœ¼ë¡œ ì¶œë ¥ìš© í˜ì´ì§€ ì—´ê¸° (ê³¼ì • IDë¥¼ í•¨ê»˜ ë³´ëƒ„)
    window.open(`outing_ledger.html?room=${currentRID}`, '_blank', 'width=1300,height=900,scrollbars=yes');
}


// ì¸ì‡„ ì•„ì´ì½˜ í´ë¦­ ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
function openPrintModal() {
    const modal = document.getElementById('printSelectModal');
    const listDiv = document.getElementById('printCourseList');
    if (!modal || !listDiv) return; // ì—ëŸ¬ ë°©ì§€ìš© ì²´í¬
    
    listDiv.innerHTML = "";

    let hasActive = false;
    for (let i = 65; i <= 90; i++) {
        const rid = String.fromCharCode(i);
        const room = globalAllData[rid];
        if (room?.status?.roomStatus === 'active') {
            hasActive = true;
            const cName = room.settings?.courseName || `Room ${rid}`;
            const btn = document.createElement('button');
            btn.className = "navy-btn";
            btn.style = "background:#fff; color:var(--navy-dark); border:1.5px solid #e2e8f0; justify-content:flex-start; padding-left:15px; margin-bottom:5px;";
            btn.innerHTML = `<i class="fa-solid fa-file-lines" style="color:var(--blue-main); margin-right:10px;"></i> ${cName}`;
            btn.onclick = () => {
                window.open(`outing_ledger.html?room=${rid}`, '_blank');
                modal.style.display = 'none';
            };
            listDiv.appendChild(btn);
        }
    }

    if(!hasActive) {
        listDiv.innerHTML = "<p style='text-align:center; padding:20px; color:#94a3b8; font-size:13px;'>í˜„ì¬ ìš´ì˜ ì¤‘ì¸ ê³¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
    }

    modal.style.display = 'flex';
}









  function startPrint(mode) { document.getElementById('outingManagerView').style.display='none'; const overlay = document.getElementById('loadingOverlay'); overlay.style.display = "flex"; let progress = 0; const timer = setInterval(() => { progress += 25; document.getElementById('progressFill').style.width = progress + "%"; if(progress > 100) { clearInterval(timer); overlay.style.display = "none"; executePrintProcess(mode); } }, 150); }
    function executePrintProcess(mode) { const targetBody = document.getElementById('printBody'); const targetRID = (mode === 'course') ? currentRID : ""; document.getElementById('print-info-text').innerText = `ëŒ€ìƒì¼ì: ${selectedDate}`; targetBody.innerHTML = ""; let list = []; Object.keys(globalAllData).forEach(rid => { if (mode === 'course' && rid !== targetRID) return; const actions = globalAllData[rid].admin_actions?.[selectedDate]; if(actions) Object.values(actions).forEach(a => list.push({ ...a, rid, cName: globalAllData[rid].settings?.courseName || rid })); }); list.sort((a,b)=>a.timestamp-b.timestamp).forEach((a, idx) => { const signImg = a.confirmedBySign ? `<img src="${a.confirmedBySign}" style="height:35px; mix-blend-mode:multiply;">` : ""; targetBody.innerHTML += `<tr><td>${idx+1}</td><td>${a.cName}</td><td>${a.type==='outing'?'ì™¸ì¶œ':'ì™¸ë°•'}</td><td>${a.name}</td><td>${a.phone}</td><td>${new Date(a.timestamp).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}</td><td>${signImg}</td></tr>`; }); window.print(); }
    function toggleMenu(open) { document.getElementById('sideMenu').classList.toggle('open', open); document.getElementById('menuOverlay').style.display = open ? "block" : "none"; }
    function closeSetupModal() { document.getElementById('setupModal').style.display = "none"; }
    function closeTransportModal() { document.getElementById('transportModal').style.display = 'none'; }
    function getTodayString(d = new Date()) { return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; }
    function autoGrow(el) { el.style.height = "5px"; el.style.height = (el.scrollHeight) + "px"; }
    function checkLocationDirect(v) { document.getElementById('setup-location-direct').style.display = (v === 'direct') ? "block" : "none"; }
    function saveCourseNotice() { if(currentRID) firebase.database().ref(`courses/${currentRID}/coordNotice`).set(document.getElementById('courseNotice').value).then(()=>alert("ì €ì¥ ì™„ë£Œ")); }
    function saveGlobalNotice() { firebase.database().ref(`system/globalNotice`).set(document.getElementById('globalNotice').value).then(()=>alert("ì €ì¥ ì™„ë£Œ")); }
    async function handleQRUpload(input) { const reader = new FileReader(); reader.onload = async (e) => { await firebase.database().ref(`courses/${currentRID}/attendanceQR`).set(e.target.result); alert("QR ì €ì¥ ì™„ë£Œ"); updateQRPreview(); }; reader.readAsDataURL(input.files[0]); }
    function updateQRPreview() { const room = globalAllData[currentRID]; const img = document.getElementById('qrPreview'); const empty = document.getElementById('qrEmpty'); if(room?.attendanceQR) { img.src = room.attendanceQR; img.style.display = "block"; empty.style.display = "none"; } else { img.style.display = "none"; empty.style.display = "block"; } }
    function loadActionHistory(date) { selectedDate = date; renderTotalHistory(); }
    function showEntryMemberList() { const room = globalAllData[currentRID]; const valid = Object.values(room.students || {}).filter(s => s.name && s.name !== "undefined"); const list = Array.from(new Set(valid.map(s => s.name))).sort().join(", "); alert(`[ì…êµ ëª…ë‹¨]\n\n${list || "ì…êµì ì—†ìŒ"}`); }
// [ê°œí¸] ëª©ì ì§€ë³„ í´ë¦­ ì‹œ ìƒì„¸ ëª…ë‹¨ íŒì—…
    function showShuttleMembers(locType) {
        const room = globalAllData[currentRID];
        // ê°œí¸ëœ ë°ì´í„° ê²½ë¡œ(requests)ì—ì„œ ê°€ì ¸ì˜µë‹ˆë‹¤.
        const requests = room.shuttle?.requests || {};
        const typeNames = { osong: 'ì˜¤ì†¡ì—­', terminal: 'ì²­ì£¼í„°ë¯¸ë„', airport: 'ì²­ì£¼ê³µí•­', car: 'ìì°¨/ê°œë³„ì´ë™' };
        
        const members = Object.values(requests)
            .filter(r => r.type === locType)
            .map(r => `${r.name}(${r.phone})`)
            .sort();

        alert(`[${typeNames[locType]} ì‹ ì²­ ëª…ë‹¨]\n\n${members.join(", ") || "ì‹ ì²­ì ì—†ìŒ"}`);
    }

    setInterval(() => { const now = new Date(); const week = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† ']; document.getElementById('footer-date').innerText = `${now.getFullYear()}.${now.getMonth()+1}.${now.getDate()} (${week[now.getDay()]}) ${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`; }, 1000);
    firebase.database().ref('system/professors').on('value', snap => {
        const sel = document.getElementById('setup-prof-select'); if(sel) { sel.innerHTML = '<option value="">êµìˆ˜ ì„ íƒ</option>'; Object.values(snap.val() || {}).forEach(n => sel.add(new Option(n, n))); }
    });







// ìƒí™œê´€ ë°°ì • í˜„í™© ë¡œì§ ì¶”ê°€
    async function openDormManager() {
        toggleMenu(false);
        const tbody = document.getElementById('dormTableBody');
        tbody.innerHTML = "<tr><td colspan='4' style='padding:20px;'>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>";
        document.getElementById('dormManagerModal').style.display = 'flex';

        try {
            const [studentSnap, dormSnap] = await Promise.all([
                firebase.database().ref(`courses/${currentRID}/students`).once('value'),
                firebase.database().ref(`system/dormitory_assignments`).once('value')
            ]);

            const students = studentSnap.val() || {};
            const dormData = dormSnap.val() || {};
            tbody.innerHTML = "";

            const studentList = Object.values(students)
                .filter(s => s.name && s.name !== "undefined")
                .sort((a, b) => a.name.localeCompare(b.name));

            if (studentList.length === 0) {
                tbody.innerHTML = "<tr><td colspan='4' style='padding:20px;'>ì…êµí•œ êµìœ¡ìƒì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>";
                return;
            }

            studentList.forEach(s => {
                const sPhone = s.phone ? s.phone.slice(-4) : "";
                let assigned = dormData[`${s.name.trim()}_${sPhone}`] || dormData[s.name.trim()] || { building: "-", room: "ë¯¸ë°°ì •" };
                
                tbody.innerHTML += `
                    <tr>
                        <td style="font-weight:800;">${s.name}</td>
                        <td style="color:#64748b;">${sPhone}</td>
                        <td style="color:var(--blue-deep);">${assigned.building}</td>
                        <td style="font-weight:800;">${assigned.room}${assigned.room !== 'ë¯¸ë°°ì •' ? 'í˜¸' : ''}</td>
                    </tr>`;
            });
        } catch (e) {
            tbody.innerHTML = "<tr><td colspan='4' style='color:red;'>ì˜¤ë¥˜ ë°œìƒ: " + e.message + "</td></tr>";
        }
    }



// [ì‹ ê·œ] ìƒì„¸ ë‚´ì—­ íŒì—… í‘œì‹œ í•¨ìˆ˜
function showActionDetail(dataJson) {
    const data = JSON.parse(decodeURIComponent(dataJson));
    const content = document.getElementById('actionDetailContent');
    
    const typeNm = data.type === 'outing' ? '<span style="color:#ea580c;">ì™¸ì¶œ(ë‹¹ì¼)</span>' : '<span style="color:#dc2626;">ì™¸ë°•(ìµì¼)</span>';
    const returnStatus = data.returned ? `<b style="color:#10b981;">[ë³µê·€ë³´ê³  ì™„ë£Œ: ${data.returnReportTime}]</b>` : `<b style="color:#ef4444;">[ë¯¸ë³µê·€ / ì™¸ì¶œì¤‘]</b>`;

    content.innerHTML = `
        <div style="border-bottom: 2px solid #f1f5f9; padding-bottom: 10px; margin-bottom: 5px;">
            <div style="font-size: 13px; color: #64748b; font-weight: 800;">ì‹ ì²­ì ë° ìœ í˜•</div>
            <div style="font-size: 18px; font-weight: 900;">${data.name} <small style="font-size:13px; font-weight:700; margin-left:5px;">(${typeNm})</small></div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div style="background:#f8fafc; padding:10px; border-radius:8px;">
                <div style="font-size:11px; color:#94a3b8; font-weight:800;">ì†Œì†</div>
                <div style="font-weight:700; font-size:14px;">${data.dept || '-'}</div>
            </div>
            <div style="background:#f8fafc; padding:10px; border-radius:8px;">
                <div style="font-size:11px; color:#94a3b8; font-weight:800;">ì—°ë½ì²˜</div>
                <div style="font-weight:700; font-size:14px;">${data.phone || '-'}</div>
            </div>
        </div>
        <div style="background:#f0f9ff; padding:12px; border-radius:8px; border:1px solid #e0f2fe;">
            <div style="font-size:11px; color:#3b82f6; font-weight:800;">ì™¸ì¶œ/ë³µê·€ ì‹œê°„</div>
            <div style="font-weight:800; font-size:15px;">${data.startTime} ~ ${data.endTime}</div>
            ${data.type === 'overnight' ? `<div style="font-size:12px; color:#64748b; margin-top:2px;">(ë³µê·€ì˜ˆì •ì¼: ${data.returnDate})</div>` : ''}
        </div>
        <div style="background:#f8fafc; padding:12px; border-radius:8px;">
            <div style="font-size:11px; color:#94a3b8; font-weight:800;">í–‰ì„ ì§€</div>
            <div style="font-weight:700; font-size:14px; margin-bottom:8px;">${data.destination || '-'}</div>
            <div style="font-size:11px; color:#94a3b8; font-weight:800;">ì‹ ì²­ ì‚¬ìœ </div>
            <div style="font-weight:700; font-size:14px;">${data.reason || '-'}</div>
        </div>
        <div style="text-align:center; padding:5px;">
            ${returnStatus}
        </div>
    `;
    
    document.getElementById('actionDetailModal').style.display = 'flex';
}



// [ìˆ˜ì •] ê°•ì‚¬ í”½ì—… ë·° ì§„ì… ì‹œ í”Œë¡œíŒ… ë²„íŠ¼ í‘œì‹œ
function showPickupView() {
    currentRID = ""; 
    handleRoomSelection(); 
    document.getElementById('totalStatusView').style.display = "none";
    document.getElementById('pickupStatusView').style.display = "flex";
    
    const homeBtn = document.getElementById('floatingHomeBtn');
    if(homeBtn) homeBtn.style.display = "flex";
    
    renderPickupTable();
}





// [ìˆ˜ì •] êµìœ¡ìƒ ìˆ˜ì†¡ ë·° ì§„ì… ì‹œ í”Œë¡œíŒ… ë²„íŠ¼ í‘œì‹œ
function showStudentShuttleView() {
    currentRID = "";
    handleRoomSelection();
    document.getElementById('totalStatusView').style.display = "none";
    document.getElementById('studentShuttleView').style.display = "flex";
    
    const homeBtn = document.getElementById('floatingHomeBtn');
    if(homeBtn) homeBtn.style.display = "flex";
    
    renderShuttleTotalTable();
}





 
// [ìˆ˜ì •] ê°•ì‚¬ ìˆ˜ì†¡ í†µí•© í˜„í™© (ë‚ ì§œ ì •ë³´ ì¶”ê°€ ë²„ì „)
  function renderPickupTable() {
    const container = document.getElementById('pickupCardContainer');
    if(!container) return;
    
    firebase.database().ref('system/transport_requests').on('value', snap => {
        const data = snap.val() || {};
        const items = Object.keys(data).map(k => ({ id: k, ...data[k] }));
        if (items.length === 0) {
            container.innerHTML = '<div style="padding:50px; color:#fff; text-align:center; font-size:14px; font-weight:800;">ìˆ˜ì†¡ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            return;
        }

        const grouped = {};
        items.forEach(r => {
            const groupKey = `${r.prof}_${r.date}_${r.courseRID}`;
            if (!grouped[groupKey]) grouped[groupKey] = { prof: r.prof, date: r.date, phone: r.phone, courseRID: r.courseRID, requests: [] };
            grouped[groupKey].requests.push(r);
        });

        const sortedGroups = Object.values(grouped).sort((a, b) => a.date.localeCompare(b.date));
        let html = "";
        let lastDate = "";

        sortedGroups.forEach(group => {
            if(group.date !== lastDate) {
                html += `<div class="chat-date-line"><span>${group.date}</span></div>`;
                lastDate = group.date;
            }

            const roomInfo = globalAllData[group.courseRID];
            const cName = roomInfo?.settings?.courseName || `ê³¼ì •`;
            const dayNames = ["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];
            const dIdx = new Date(group.date).getDay();
            const dateWithDay = `${group.date}(${dayNames[dIdx]})`;

            group.requests.sort((a,b) => a.time.localeCompare(b.time));

            let timeLines = group.requests.map(r => {
                const isCan = r.status === 'cancelled';
                return `<div style="${isCan?'text-decoration:line-through; opacity:0.5;':''}">- ${r.time} ${r.dir.replace('â†’',' >> ')} ${isCan?'(ì·¨ì†Œë¨)':''}</div>`;
            }).join('');
            
            const cancelButtons = group.requests.map(r => 
                (r.status !== 'cancelled') ? `<button class="btn-cancel-talk" onclick="deleteTrans('${r.id}')">${r.status==='approved'?'ìŠ¹ì¸ì·¨ì†Œ':'ìš”ì²­ì·¨ì†Œ'}(${r.time})</button>` : ''
            ).join(' ');

            html += `
                <div class="chat-bubble chat-right">
                    <div class="talk-header" style="text-align:right;">ë³´ë‚¸ ìˆ˜ì†¡ìš”ì²­</div>
                    <div class="bubble-admin">
                        <div class="talk-body">
                            &lt;${cName}&gt;
                            - ${dateWithDay}
                            - ${group.prof} ê°•ì‚¬ë‹˜ (${formatPhone(group.phone)})
                            ${timeLines}
                        </div>
                        <div class="talk-footer" style="justify-content: flex-end;">
                            <div style="display:flex; gap:8px;">${cancelButtons}</div>
                        </div>
                    </div>
                    <div class="chat-time">ë‚˜(ìš´ì˜ë¶€)</div>
                </div>`;

            group.requests.forEach(r => {
                if(r.status === 'approved') {
                    // [ìˆ˜ì • í¬ì¸íŠ¸] ë‚ ì§œ(dateWithDay) ì •ë³´ ì¶”ê°€
                    html += `
                        <div class="chat-bubble chat-left">
                            <div class="talk-header">ê¸°ì‚¬ë‹˜ íšŒì‹ </div>
                            <div class="bubble-driver">
                                ë„¤ í™•ì¸í–ˆìŠµë‹ˆë‹¤.<br>
                                <b>&lt;${cName}&gt; ${r.prof} ê°•ì‚¬ë‹˜</b><br>
                                ${dateWithDay} [${r.time}]<br>
                                ${r.dir.replace('â†’',' >> ')}<br>
                                ë°°ì°¨ ìŠ¹ì¸ ì™„ë£Œ!
                            </div>
                            <div class="chat-time">ìš´ì „ì›</div>
                        </div>`;
                } else if(r.status === 'cancelled') {
                   html += `<div style="text-align:center; font-size:11px; color:#ef4444; margin:5px 0; font-weight:800; background:rgba(255,255,255,0.5); padding:5px; border-radius:10px;">ğŸš« [${r.time} ${r.prof} ê°•ì‚¬ë‹˜] ì¼ì •ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.</div>`;
                }
            });
        });

        container.innerHTML = html;
        container.scrollTop = container.scrollHeight;
    });
  }







// [ìˆ˜ì •] êµìœ¡ìƒ í‡´êµì°¨ëŸ‰ í†µí•© í…Œì´ë¸” ê·¸ë¦¬ê¸°
function renderShuttleTotalTable() {
    const tbody = document.getElementById('shuttleTotalTableBody');
    if(!tbody) return;

    let html = "";
    for (let i = 65; i <= 90; i++) {
        const rid = String.fromCharCode(i);
        const room = globalAllData[rid];
        if (room?.status?.roomStatus === 'active') {
            const requests = room.shuttle?.requests || {};
            const items = Object.values(requests);
            
            // ì‹ ì²­ ë‚´ì—­ì´ ì—†ì–´ë„ ê³¼ì •ëª…ì€ ë‚˜ì˜¤ê²Œ í•˜ê±°ë‚˜, í•„í„°ë§ ê°€ëŠ¥
            const cName = room.settings?.courseName || rid;
            const rO = items.filter(i => i.type === 'osong').length;
            const rT = items.filter(i => i.type === 'terminal').length;
            const rA = items.filter(i => i.type === 'airport').length;
            const rC = items.filter(i => i.type === 'car').length;

            // í–‰(tr) í´ë¦­ ì‹œ í•´ë‹¹ RIDë¥¼ ì¸ìë¡œ ì „ë‹¬í•˜ì—¬ ìƒì„¸ íŒì—… ì‹¤í–‰
            html += `
                <tr onclick="showShuttleApplicationDetails('${rid}')" style="cursor:pointer;" class="shuttle-row-hover">
                    <td style="text-align:left; padding-left:15px; font-weight:800; color:var(--blue-deep);">${cName}</td>
                    <td style="font-weight:900; background:#f0f9ff;">${items.length}</td>
                    <td style="color:#ef4444; font-weight:800;">${rO}</td>
                    <td style="color:#3b82f6; font-weight:800;">${rT}</td>
                    <td style="color:#10b981; font-weight:800;">${rA}</td>
                    <td style="color:#64748b;">${rC}</td>
                </tr>`;
        }
    }
    tbody.innerHTML = html || '<tr><td colspan="6" style="padding:40px; color:#94a3b8;">ìš´ì˜ ì¤‘ì¸ ê³¼ì •ì˜ ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
}





// [ìµœì¢…] ê²©ì ì •ë ¬ ë° ìŠ¤í¬ë¡¤ ì ê¸ˆì´ ì ìš©ëœ í‡´êµ ì°¨ëŸ‰ ìƒì„¸ íŒì—…
async function showShuttleApplicationDetails(rid) {
    const targetRID = rid || currentRID;
    const room = globalAllData[targetRID];
    if (!room) return;

    // íŒì—… ì—´ ë•Œ ë°°ê²½ ìŠ¤í¬ë¡¤ ì°¨ë‹¨
    document.body.classList.add('modal-open');

    const cName = room.settings?.courseName || targetRID;
    const requests = room.shuttle?.requests || {};
    const appliedData = Object.values(requests);

    // ê°€ë‚˜ë‹¤ìˆœ ì •ë ¬ì„ ë¯¸ë¦¬ ìˆ˜í–‰
    appliedData.sort((a, b) => a.name.localeCompare(b.name));

    const categories = {
        osong: { title: "ì˜¤ì†¡ì—­", color: "bg-osong", icon: "fa-train", members: [] },
        terminal: { title: "ì²­ì£¼í„°ë¯¸ë„", color: "bg-terminal", icon: "fa-bus", members: [] },
        airport: { title: "ì²­ì£¼ê³µí•­", color: "bg-airport", icon: "fa-plane", members: [] },
        car: { title: "ìì°¨/ê°œë³„", color: "bg-car", icon: "fa-car", members: [] }
    };

    appliedData.forEach(req => {
        if (categories[req.type] && req.name && req.name !== "undefined") {
            const phoneSuffix = req.phone ? `(${req.phone.slice(-4)})` : "";
            categories[req.type].members.push(`${req.name}${phoneSuffix}`);
        }
    });

    let html = `<div style="margin-bottom:15px; font-weight:800; color:var(--navy-bg); font-size:15px; padding-left:5px;">[${cName}] ìˆ˜ì†¡ ëª…ë‹¨</div>`;
    
    Object.keys(categories).forEach(key => {
        const cat = categories[key];
        html += `
            <div class="shuttle-detail-section">
                <div class="shuttle-detail-header ${cat.color}" style="border-bottom:1px solid rgba(0,0,0,0.05);">
                    <span style="font-weight:900;"><i class="fa-solid ${cat.icon}"></i> ${cat.title} (${cat.members.length}ëª…)</span>
                </div>
                <div class="shuttle-detail-list">
                    ${cat.members.length > 0 ? cat.members.map(m => `<span>${m}</span>`).join('') : '<div style="grid-column: span 3; padding: 20px; color: #cbd5e1; text-align: center; font-size: 12px;">ì‹ ì²­ì ì—†ìŒ</div>'}
                </div>
            </div>
        `;
    });

    document.getElementById('shuttleDetailContent').innerHTML = html;
    document.getElementById('shuttleDetailModal').style.display = 'flex';
}




// [ì‹ ê·œ] ì–´ë–¤ íŒì—…ì´ë“  ì—´ë¦¬ë©´ í™ˆ ë²„íŠ¼ì„ ê°•ì œë¡œ ë³´ì—¬ì£¼ëŠ” ê°ì‹œ ë¡œì§
function showHomeBtnOnPopup() {
    const homeBtn = document.getElementById('floatingHomeBtn');
    if(!homeBtn) return;

    // í˜ì´ì§€ ë‚´ì˜ ëª¨ë“  'setup-modal' í´ë˜ìŠ¤ë¥¼ ê°€ì§„ ìš”ì†Œë¥¼ ê°ì‹œ
    const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            if (mutation.attributeName === 'style') {
                const isAnyModalVisible = Array.from(document.querySelectorAll('.setup-modal, .modal-overlay, #outingManagerView'))
                    .some(el => el.style.display === 'flex' || el.style.display === 'block');
                
                if (isAnyModalVisible || currentRID !== "") {
                    homeBtn.style.display = 'flex';
                } else {
                    homeBtn.style.display = 'none';
                }
            }
        });
    });

    // ê°ì‹œ ëŒ€ìƒ ì„¤ì •
    document.querySelectorAll('.setup-modal, .modal-overlay, #outingManagerView').forEach(modal => {
        observer.observe(modal, { attributes: true });
    });
}

// ê¸°ì¡´ init í•¨ìˆ˜ì— ê°ì‹œ ë¡œì§ ì¶”ê°€
const originalInitSupport = init;
init = function() {
    originalInitSupport();
    showHomeBtnOnPopup();
};



// ìˆ«ìë¥¼ íœ´ëŒ€í° ë²ˆí˜¸ í˜•ì‹(í•˜ì´í”ˆ)ìœ¼ë¡œ ë°”ê¿”ì£¼ëŠ” í•¨ìˆ˜
  function formatPhone(num) {
    if (!num) return "";
    // ìˆ«ìë§Œ ë‚¨ê¸°ê¸°
    const s = num.replace(/[^0-9]/g, "");
    if (s.length === 11) {
      return s.replace(/(\d{3})(\d{4})(\d{4})/, "$1-$2-$3");
    } else if (s.length === 10) {
      return s.replace(/(\d{3})(\d{3})(\d{4})/, "$1-$2-$3");
    }
    return num; // í˜•ì‹ì´ ì•ˆ ë§ìœ¼ë©´ ê·¸ëƒ¥ ì›ë³¸ ì¶œë ¥
  }




    init();
  </script>


<!-- í‡´êµ ì°¨ëŸ‰ ìƒì„¸ ì‹ ì²­ í˜„í™© ëª¨ë‹¬ -->
<div id="shuttleDetailModal" class="setup-modal" style="display:none;">
    <div class="setup-box" style="max-width: 600px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:2px solid #eee; padding-bottom:10px;">
            <h3 style="margin:0; font-size:18px; color:var(--navy-dark);"><i class="fa-solid fa-list-check"></i> í‡´êµ ì°¨ëŸ‰ ìƒì„¸ ì‹ ì²­ ë‚´ì—­</h3>
            <i class="fa-solid fa-xmark" style="cursor:pointer; font-size:22px;" onclick="document.getElementById('shuttleDetailModal').style.display='none'; document.body.classList.remove('modal-open');"></i>
        </div>
        <div id="shuttleDetailContent" style="max-height: 500px; overflow-y: auto;">
            <!-- JSì—ì„œ ë‚´ìš© ìƒì„± -->
        </div>
        <button class="navy-btn" style="margin-top:20px; background:#64748b;" onclick="document.getElementById('shuttleDetailModal').style.display='none'">ë‹«ê¸°</button>
    </div>
</div>







</body>
</html>