<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§ˆë¬¸ ë“±ë¡ - CATC</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; background: #f4f6f8;}
        .header { display: flex; justify-content: space-between; align-items: center; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .logo { font-weight: bold; color: #007bff; }
        
        .input-box { background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        textarea { width: 100%; height: 80px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; resize: none; }
        button#submitBtn { width: 100%; margin-top: 10px; padding: 12px; background: #007bff; color: white; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }
        
        .q-list { margin-top: 20px; }
        .q-item { background: #fff; padding: 15px; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; }
        .q-text { width: 75%; font-size: 16px; word-break: break-all; }
        
        /* ì¢‹ì•„ìš” ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .like-btn { background: #fff; border: 1px solid #ddd; padding: 5px 10px; border-radius: 20px; cursor: pointer; color: #555; display: flex; align-items: center; gap: 5px; font-size: 14px; transition: 0.2s; }
        .like-btn.active { background: #ffebee; border-color: #ff5252; color: #ff5252; }
        .like-btn:hover { background: #f1f1f1; }
    </style>
</head>
<body>
    <div class="header">
        <h3>CATC ì§ˆë¬¸ ë“±ë¡</h3>
        <div class="logo">LOGO</div>
    </div>

    <div class="input-box">
        <textarea id="questionInput" placeholder="ê°•ì‚¬ë‹˜ê»˜ ê¶ê¸ˆí•œ ì ì„ ë‚¨ê²¨ì£¼ì„¸ìš”."></textarea>
        <button id="submitBtn" onclick="submitQuestion()">ì§ˆë¬¸ ë“±ë¡í•˜ê¸°</button>
    </div>

    <div class="q-list">
        <h4 style="margin-left: 5px; color:#555;">ì‹¤ì‹œê°„ ì§ˆë¬¸ ëª©ë¡</h4>
        <div id="studentList">Loading...</div>
    </div>

    <script src="config.js"></script>
    <script>
        function submitQuestion() {
            if (typeof db === 'undefined') return alert("DB ì—°ê²° ì‹¤íŒ¨. config.jsë¥¼ í™•ì¸í•˜ì„¸ìš”.");
            const input = document.getElementById('questionInput');
            if(input.value.trim() === "") return alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

            db.ref('questions').push({
                text: input.value,
                likes: 0,
                isDone: false,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            });
            input.value = ""; 
        }

        if (typeof db !== 'undefined') {
            db.ref('questions').on('value', (snapshot) => {
                const listDiv = document.getElementById('studentList');
                listDiv.innerHTML = ""; 
                const data = snapshot.val();
                if(!data) { listDiv.innerHTML = "<p style='padding:10px; color:#888;'>ë“±ë¡ëœ ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>"; return; }

                let items = Object.keys(data).map(key => ({ id: key, ...data[key] }));
                
                // ì •ë ¬: ìµœì‹ ìˆœ
                items.sort((a, b) => b.timestamp - a.timestamp);

                items.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'q-item';
                    div.innerHTML = `
                        <div class="q-text">${item.text}</div>
                        <button class="like-btn" onclick="likeQuestion('${item.id}', ${item.likes})">
                            ğŸ‘ <span>${item.likes || 0}</span>
                        </button>
                    `;
                    listDiv.appendChild(div);
                });
            });
        }

        // ì¢‹ì•„ìš” ê¸°ëŠ¥ (íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë™ì‹œì„± ì²˜ë¦¬)
        function likeQuestion(key, currentLikes) {
            db.ref('questions/' + key).transaction((post) => {
                if (post) {
                    post.likes = (post.likes || 0) + 1;
                }
                return post;
            });
        }
    </script>
</body>
</html>