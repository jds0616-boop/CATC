<!-- index.html의 스크립트 부분 수정 -->
<script>
    // ... (bc 채널 로직 등 기존 코드 유지) ...

    const params = new URLSearchParams(window.location.search);
    const code = params.get('code');
    const directRoom = params.get('room'); // 테스트용

    // [수정] 비동기 함수로 감싸야 함
    (async function initStudent() {
        let currentRoom = null;

        if (code) {
            // DB에서 코드로 방 찾기 (config.js의 수정된 함수)
            currentRoom = await resolveRoomFromCode(code);
        } else if (directRoom) {
            currentRoom = directRoom;
        }

        if(!currentRoom) { 
            document.body.innerHTML = "<div style='display:flex;height:100vh;justify-content:center;align-items:center;flex-direction:column;'><h2>유효하지 않은 링크입니다.</h2><p>QR코드를 다시 스캔해주세요.</p></div>"; 
            return;
        }

        document.getElementById('roomBadge').innerText = `ROOM ${currentRoom}`;

        // ... (이하 기존 dbRef 및 이벤트 리스너 로직 동일) ...
        const dbRef = {
            qa: db.ref(`courses/${currentRoom}/questions`),
            quiz: db.ref(`courses/${currentRoom}/activeQuiz`),
            ans: db.ref(`courses/${currentRoom}/quizAnswers`),
            settings: db.ref(`courses/${currentRoom}/settings`),
            status: db.ref(`courses/${currentRoom}/status/mode`)
        };
        
        // ... (나머지 좋아요, 질문 등록 로직 등 기존 코드 그대로 유지) ...

    })(); // IIFE 실행
</script>